<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Collatz | Graphics Labs</title>
    <meta name="description" content="Visualizaci√≥n art√≠stica de la Conjetura de Collatz (3x+1).">
    <style>
        /* --- ESTILOS BASE --- */
        :root {
            --primary: #00ff41; 
            --primary-dim: rgba(0, 255, 65, 0.3);
            --secondary: #bd00ff;
            --highlight: #ffee00;
            --glass: rgba(20, 20, 20, 0.7);
            --glass-text: rgba(30, 30, 30, 0.8);
            --border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --muted: #aaaaaa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', monospace, sans-serif; }
        
        body {
            background-color: #050505;
            color: var(--text);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            user-select: none;
        }

        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* --- CONTROLES --- */
        .controls {
            background: var(--glass);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin: 20px auto;
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .input-row {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .slider-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            min-width: 150px;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 10px var(--primary);
            transition: 0.2s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }

        .value-display { font-family: 'Courier New', monospace; color: var(--highlight); font-weight: bold; font-size: 0.9rem; }

        .buttons-row { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-top: 10px; }

        button.action-btn {
            background: var(--primary); color: #000; border: none; padding: 10px 20px; border-radius: 5px;
            cursor: pointer; font-weight: bold; transition: 0.3s; text-transform: uppercase; font-size: 0.9rem;
        }
        button.action-btn:hover { box-shadow: 0 0 15px var(--primary); transform: scale(1.05); }
        
        button.secondary-btn {
            background: transparent; border: 1px solid var(--secondary); color: var(--secondary);
            padding: 8px 15px; border-radius: 5px; cursor: pointer; transition: 0.3s; font-size: 0.9rem;
            display: flex; align-items: center; gap: 5px;
        }
        button.secondary-btn:hover { background: var(--secondary); color: #fff; box-shadow: 0 0 15px var(--secondary); }

        /* --- VISUALIZADOR --- */
        #canvas-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            margin-bottom: 20px;
            position: relative;
            z-index: 10;
        }

        #collatz-canvas {
            background: #000;
            border: 1px solid var(--border);
            border-radius: 4px;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.1);
            max-width: 100%;
        }

        /* --- INFO --- */
        .info-section {
            background: var(--glass-text);
            padding: 40px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin: 40px auto;
            max-width: 900px;
            text-align: left;
            line-height: 1.8;
            color: #ddd;
        }
        .info-section h2 { color: var(--primary); margin-bottom: 20px; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-top: 40px; }
        .info-section h2:first-child { margin-top: 0; }
        .info-section p { margin-bottom: 20px; font-size: 1rem; text-align: justify; }
        
        .math-box {
            background: rgba(0,0,0,0.5);
            border-left: 4px solid var(--secondary);
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            color: var(--secondary);
            font-size: 1.2rem;
            line-height: 1.6;
            text-align: center;
        }

        .dl-section { margin-top: 30px; border-top: 1px dashed var(--border); padding-top: 20px; text-align: center; }
        
        input[type="number"] {
            background: rgba(0,0,0,0.5); border: 1px solid var(--primary); color: var(--primary);
            padding: 10px; border-radius: 5px; width: 150px; font-size: 1rem; text-align: center;
        }
        
        .btn-txt-dl {
            display: inline-block; background: rgba(255, 255, 255, 0.1); color: var(--muted); text-decoration: none;
            padding: 15px 25px; border: 1px solid var(--muted); border-radius: 4px; font-family: var(--font-mono);
            font-size: 0.9rem; transition: 0.3s; cursor: pointer;
        }
        .btn-txt-dl:hover { background: var(--secondary); color: #000; border-color: var(--secondary); box-shadow: 0 0 10px var(--secondary); }

        .ad-container {
            width: 100%; max-width: 728px; margin: 30px auto; min-height: 90px;
            display: flex; justify-content: center; align-items: center;
            border: 1px dashed rgba(255,255,255,0.1); border-radius: 8px; background: rgba(0,0,0,0.2);
        }
        .ad-placeholder-text { color: var(--border); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; }

        /* Nav & Footer */
        nav { display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .nav-links { display: flex; gap: 15px; }
        .nav-btn { text-decoration: none; color: var(--muted); font-size: 0.9rem; border: 1px solid var(--border); padding: 5px 10px; border-radius: 4px; transition: 0.3s; background: rgba(0,0,0,0.5); }
        .nav-btn:hover { color: var(--primary); border-color: var(--primary); }
        .logo { font-size: 1.2rem; font-weight: bold; color: var(--primary); text-decoration: none; letter-spacing: 2px; }
        .lang-switch button { background: rgba(0,0,0,0.5); border: 1px solid var(--border); color: var(--muted); padding: 5px 10px; cursor: pointer; border-radius: 4px; margin-left: 2px;}
        .lang-switch button.active { background-color: var(--primary) !important; color: #000 !important; border-color: var(--primary) !important; font-weight: bold; }
        footer { margin-top: auto; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); border-top: 1px solid var(--border); padding: 30px 20px; text-align: center; font-size: 0.8rem; color: var(--muted); display: flex; flex-direction: column; gap: 15px; align-items: center; position: relative; z-index: 20; }
        .legal-links { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; margin-bottom: 10px; }
        .legal-links a { color: var(--muted); text-decoration: none; transition: 0.3s; border-bottom: 1px solid transparent; }
        .legal-links a:hover { color: var(--primary); border-bottom-color: var(--primary); }
        .coffee-btn { background: linear-gradient(45deg, #FFDD00, #FBB03B); color: #000; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-weight: bold; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 5px; transition: transform 0.2s; }
        .coffee-btn:hover { transform: scale(1.05); }

    </style>
</head>
<body oncontextmenu="return false;">

    <canvas id="bg-canvas"></canvas>

    <div class="container">
        <nav>
            <div class="nav-links">
                <a href="../../index.html" class="nav-btn" id="nav-main">‚Üê HUB PRINCIPAL</a>
                <a href="../index.html" class="nav-btn" id="nav-math">‚Üê HUB MATH</a>
            </div>
            <div class="logo">GRAPHICS LABS</div>
            <div class="lang-switch">
                <button onclick="setLang('es')" id="btn-es" class="active">ES</button>
                <button onclick="setLang('ca')" id="btn-ca">CA</button>
                <button onclick="setLang('en')" id="btn-en">EN</button>
                <button onclick="setLang('fr')" id="btn-fr">FR</button>
                <button onclick="setLang('de')" id="btn-de">DE</button>
                <button onclick="setLang('pt')" id="btn-pt">PT</button>
                <button onclick="setLang('it')" id="btn-it">IT</button>
                <button onclick="setLang('nl')" id="btn-nl">NL</button>
                <button onclick="setLang('ja')" id="btn-ja">JP</button>
            </div>
        </nav>

        <h1 id="txt-title">PROYECTO COLLATZ</h1>
        <p style="color:var(--muted); margin-bottom: 20px;" id="txt-desc">Visualizaci√≥n de la Conjetura 3x+1 y arte generativo.</p>

        <div class="controls">
            
            <div class="input-row">
                <div class="slider-group">
                    <label id="lbl-angle">√Ångulo de Giro:</label>
                    <input type="range" id="sl-angle" min="0.01" max="0.5" step="0.01" value="0.15">
                    <div class="value-display" id="val-angle">0.15 rad</div>
                </div>
                
                <div class="slider-group">
                    <label id="lbl-len">Longitud L√≠nea:</label>
                    <input type="range" id="sl-len" min="2" max="20" step="1" value="7">
                </div>

                <div class="slider-group">
                    <label id="lbl-opacity">Opacidad:</label>
                    <input type="range" id="sl-opacity" min="0.05" max="1" step="0.05" value="0.2">
                </div>
            </div>

            <div class="buttons-row">
                <button class="action-btn" onclick="drawCollatz()" id="btn-draw">GENERAR ARTE</button>
                <button class="secondary-btn" onclick="toggleColor()" id="btn-color">üé® COLOR</button>
                <button class="secondary-btn" onclick="saveHighRes()" id="btn-save">üíæ IMG HQ</button>
            </div>
        </div>

        <div id="canvas-container">
            <canvas id="collatz-canvas" width="800" height="600"></canvas>
            <p style="color:var(--muted); font-size: 0.8rem; margin-top:5px;" id="txt-note">Cada l√≠nea representa el "vuelo" de un n√∫mero hasta llegar a 1.</p>
        </div>

        <div class="info-section">
            <h2 id="info-h-simple">El Problema m√°s Simple e Imposible</h2>
            <p id="info-p-simple">
                La Conjetura de Collatz es famosa por ser incre√≠blemente f√°cil de explicar pero imposible de demostrar. Toma cualquier n√∫mero entero positivo n:
            </p>
            <div class="math-box">
                Si es PAR: n = n / 2<br>
                Si es IMPAR: n = 3n + 1
            </div>
            <p id="info-p-loop">
                Repite el proceso. La conjetura dice que, sin importar qu√© n√∫mero elijas, siempre caer√° en el bucle infinito 4 ‚Üí 2 ‚Üí 1.
            </p>

            <h2 id="info-h-art">¬øC√≥mo funciona la Visualizaci√≥n?</h2>
            <p id="info-p-art">
                En este gr√°fico, dibujamos el camino inverso. Empezamos desde abajo y trazamos la trayectoria de miles de n√∫meros. Si el siguiente paso es par, giramos a un lado; si es impar, al otro. El resultado es una estructura org√°nica parecida a algas marinas.
            </p>
            
            <div class="dl-section">
                <h3 style="color:var(--secondary); margin-bottom:15px;" id="h-dl-seq">Descarga de Secuencia</h3>
                <p id="p-dl-seq" style="font-size:0.9rem;">
                    Introduce un n√∫mero para calcular y descargar su "vuelo" completo hasta llegar a 1.
                </p>
                <div style="display:flex; justify-content:center; gap:10px; margin-bottom:10px;">
                    <input type="number" id="inp-number" placeholder="Ej: 27" value="27">
                    <button onclick="downloadSequence()" class="btn-txt-dl" id="btn-dl-seq">
                        ‚¨á Descargar (.txt)
                    </button>
                </div>
            </div>
        </div>

        <div class="ad-container"><span class="ad-placeholder-text">Ad Space</span></div>
    </div>

    <footer>
        <div class="legal-links">
            <a href="../../legal.html" id="link-legal">Aviso Legal</a>
            <a href="../../privacy.html" id="link-privacy">Pol√≠tica de Privacidad</a>
            <a href="../../cookies.html" id="link-cookies">Pol√≠tica de Cookies</a>
            <a href="mailto:pbazan@gmail.com" id="link-contact">Contacto</a>
        </div>
        <span id="footer-rights">¬© 2025 Graphics Labs</span>
        <a href="https://paypal.me/pbazan" target="_blank" class="coffee-btn">
            ‚òï <span id="btn-coffee">Inv√≠tame a un caf√©</span>
        </a>
    </footer>

    <script>
        /* --- 1. CONFIGURACI√ìN --- */
        const canvas = document.getElementById('collatz-canvas');
        const ctx = canvas.getContext('2d');
        
        // Elementos UI
        const slAngle = document.getElementById('sl-angle');
        const slLen = document.getElementById('sl-len');
        const slOpacity = document.getElementById('sl-opacity');
        const inpNumber = document.getElementById('inp-number');
        
        let colorMode = 0; // 0: Neon Green, 1: Heatmap (Purple/Red)

        // Event Listeners
        slAngle.oninput = () => { document.getElementById('val-angle').innerText = slAngle.value + " rad"; drawCollatz(); };
        slLen.oninput = drawCollatz;
        slOpacity.oninput = drawCollatz;

        /* --- 2. L√ìGICA MATEM√ÅTICA --- */
        function getCollatzSequence(n) {
            let seq = [];
            // Invertimos la l√≥gica para dibujar:
            // Dibujaremos desde n hasta 1.
            // Pero para el algoritmo est√°ndar calculamos normal.
            let current = n;
            while(current > 1) {
                seq.push(current);
                if(current % 2 === 0) {
                    current = current / 2;
                } else {
                    current = (current * 3) + 1;
                }
            }
            seq.push(1);
            return seq.reverse(); // De 1 hacia arriba (para dibujar como √°rbol)
        }

        /* --- 3. MOTOR DE RENDERIZADO (ESCALABLE) --- */
        function renderScene(targetCtx, width, height, scale) {
            // Limpiar fondo
            targetCtx.fillStyle = "#000";
            targetCtx.fillRect(0, 0, width, height);

            const angleOffset = parseFloat(slAngle.value);
            const len = parseInt(slLen.value) * scale; // Escalamos la longitud
            const opacity = parseFloat(slOpacity.value);

            targetCtx.lineWidth = 1 * scale; // Escalamos el grosor
            
            // Punto de inicio (centro abajo)
            const startX = width / 2;
            const startY = height - (50 * scale); // Margen escalado

            // Dibujamos las primeras 2000 secuencias
            for (let i = 1; i < 2000; i++) { 
                let sequence = getCollatzSequence(i);
                
                // Configuraci√≥n de Color
                if(colorMode === 0) {
                    targetCtx.strokeStyle = `rgba(0, 255, 65, ${opacity})`;
                } else {
                    // Gradiente basado en la longitud de la secuencia
                    let hue = (sequence.length * 2) % 360;
                    targetCtx.strokeStyle = `hsla(${hue}, 80%, 60%, ${opacity})`;
                }

                targetCtx.beginPath();
                targetCtx.moveTo(startX, startY);

                let currentX = startX;
                let currentY = startY;
                let currentAngle = -Math.PI / 2; // Apunta arriba

                // Dibujamos el camino
                for (let j = 0; j < sequence.length - 1; j++) {
                    let num = sequence[j];
                    let nextNum = sequence[j+1];

                    // Determinar giro
                    if (nextNum % 2 === 0) {
                        currentAngle -= angleOffset; // Par: Giro izquierda
                    } else {
                        currentAngle += angleOffset; // Impar: Giro derecha
                    }

                    currentX += Math.cos(currentAngle) * len;
                    currentY += Math.sin(currentAngle) * len;
                    
                    targetCtx.lineTo(currentX, currentY);
                }
                targetCtx.stroke();
            }
        }

        /* --- 4. FUNCIONES DE DIBUJO Y GUARDADO --- */
        
        // Dibuja en el canvas normal (pantalla)
        function drawCollatz() {
            renderScene(ctx, canvas.width, canvas.height, 1);
        }

        function toggleColor() {
            colorMode = (colorMode + 1) % 2;
            drawCollatz();
        }

        // Nueva funci√≥n: Renderiza en un canvas temporal de alta resoluci√≥n
        function saveHighRes() {
            // 1. Crear canvas temporal en memoria
            const tempCanvas = document.createElement('canvas');
            const scaleFactor = 3; // 3x Calidad
            
            tempCanvas.width = canvas.width * scaleFactor;  // 2400
            tempCanvas.height = canvas.height * scaleFactor; // 1800
            
            const tempCtx = tempCanvas.getContext('2d');

            // 2. Renderizar la escena escalada
            renderScene(tempCtx, tempCanvas.width, tempCanvas.height, scaleFactor);

            // 3. Descargar
            const link = document.createElement('a');
            link.download = 'collatz_high_res.png';
            link.href = tempCanvas.toDataURL('image/png');
            link.click();
        }

        function downloadSequence() {
            const num = parseInt(inpNumber.value);
            if(!num || num < 1) return;

            let n = num;
            let content = `PROJECT COLLATZ - FLIGHT PATH OF ${n}\n`;
            content += "========================================\n\n";
            content += `Start: ${n}\n`;
            
            let steps = 0;
            let max = n;

            while(n > 1) {
                let formula = (n % 2 === 0) ? "n/2" : "3n+1";
                let oldN = n;
                if(n % 2 === 0) n = n / 2;
                else n = (n * 3) + 1;
                
                if(n > max) max = n;
                steps++;
                
                content += `Step ${steps}: ${oldN} -> ${n} (${formula})\n`;
            }

            content += `\nTotal Steps: ${steps}\n`;
            content += `Highest Number Reached: ${max}\n`;
            content += "\nGenerated by Graphics Labs.";

            const blob = new Blob([content], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `collatz_sequence_${num}.txt`;
            link.click();
        }

        /* --- 5. INTERACTIVIDAD FONDO --- */
        const bgCanvas = document.getElementById('bg-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        let particlesArray = [];
        const mouse = { x: null, y: null, radius: 150 };

        window.addEventListener('mousemove', (e) => { mouse.x = e.x; mouse.y = e.y; });
        function resizeBg() { bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight; }
        window.addEventListener('resize', () => { resizeBg(); initParticles(); });
        resizeBg();

        class Particle {
            constructor() {
                this.x = Math.random() * bgCanvas.width;
                this.y = Math.random() * bgCanvas.height;
                this.size = Math.random() * 12 + 8;
                this.speedX = (Math.random() * 1) - 0.5;
                this.speedY = (Math.random() * 1) - 0.5;
                const symbols = ['3n+1', 'n/2', '4', '2', '1', '?', 'x'];
                this.text = symbols[Math.floor(Math.random() * symbols.length)];
            }
            draw() {
                bgCtx.font = this.size + 'px monospace';
                bgCtx.fillStyle = 'rgba(0, 255, 65, 0.15)'; 
                bgCtx.fillText(this.text, this.x, this.y);
            }
            update() {
                this.x += this.speedX; this.y += this.speedY;
                
                // Repulsion mouse
                if (mouse.x != null) {
                    let dx = mouse.x - this.x;
                    let dy = mouse.y - this.y;
                    let distance = Math.sqrt(dx*dx + dy*dy);
                    if (distance < mouse.radius) {
                        const forceDirectionX = dx / distance;
                        const forceDirectionY = dy / distance;
                        const force = (mouse.radius - distance) / mouse.radius;
                        this.x -= forceDirectionX * force * 5;
                        this.y -= forceDirectionY * force * 5;
                    }
                }

                if (this.x > bgCanvas.width) this.x = 0; if (this.x < 0) this.x = bgCanvas.width;
                if (this.y > bgCanvas.height) this.y = 0; if (this.y < 0) this.y = bgCanvas.height;
                this.draw();
            }
        }

        function initParticles() {
            particlesArray = [];
            let n = (bgCanvas.height * bgCanvas.width) / 9000;
            for (let i = 0; i < n; i++) particlesArray.push(new Particle());
        }
        function animateParticles() {
            bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
            for (let i = 0; i < particlesArray.length; i++) particlesArray[i].update();
            requestAnimationFrame(animateParticles);
        }
        initParticles(); animateParticles();

        /* --- 6. MULTI-IDIOMA --- */
        const translations = {
            'es': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "PROYECTO COLLATZ", desc: "Visualizaci√≥n de la Conjetura 3x+1 y arte generativo.",
                lbl_angle: "√Ångulo de Giro:", lbl_len: "Longitud L√≠nea:", lbl_opacity: "Opacidad:",
                btn_draw: "GENERAR ARTE", btn_color: "üé® COLOR", btn_save: "üíæ IMG HQ",
                txt_note: "Cada l√≠nea representa el 'vuelo' de un n√∫mero hasta llegar a 1.",
                h_simple: "El Problema m√°s Simple e Imposible",
                p_simple: "La Conjetura de Collatz es famosa por ser incre√≠blemente f√°cil de explicar pero imposible de demostrar. Toma cualquier n√∫mero entero positivo n:",
                p_loop: "Repite el proceso. La conjetura dice que, sin importar qu√© n√∫mero elijas, siempre caer√° en el bucle infinito 4 ‚Üí 2 ‚Üí 1.",
                h_art: "¬øC√≥mo funciona la Visualizaci√≥n?",
                p_art: "Dibujamos el camino inverso. Empezamos desde abajo y trazamos la trayectoria de miles de n√∫meros. Si el siguiente paso es par, giramos a un lado; si es impar, al otro. El resultado es una estructura org√°nica parecida a algas marinas.",
                h_dl_seq: "Descarga de Secuencia", p_dl_seq: "Introduce un n√∫mero para calcular su 'vuelo' completo hasta llegar a 1.",
                btn_dl_seq: "‚¨á Descargar (.txt)",
                legal: "Aviso Legal", privacy: "Privacidad", cookies: "Cookies", contact: "Contacto", coffee: "Inv√≠tame a un caf√©"
            },
            'en': {
                nav_main: "‚Üê MAIN HUB", nav_math: "‚Üê MATH HUB",
                title: "PROJECT COLLATZ", desc: "Visualization of the 3x+1 Conjecture and generative art.",
                lbl_angle: "Turn Angle:", lbl_len: "Line Length:", lbl_opacity: "Opacity:",
                btn_draw: "GENERATE ART", btn_color: "üé® COLOR", btn_save: "üíæ IMG HQ",
                txt_note: "Each line represents the 'flight' of a number reaching 1.",
                h_simple: "The Simplest Impossible Problem",
                p_simple: "The Collatz Conjecture is famous for being incredibly simple to explain but impossible to prove. Take any positive integer n:",
                p_loop: "Repeat the process. The conjecture states that no matter what number you pick, it will always fall into the infinite loop 4 ‚Üí 2 ‚Üí 1.",
                h_art: "How the Visualization Works",
                p_art: "We draw the path in reverse. Starting from the bottom, we trace the trajectory of thousands of numbers. Even steps turn one way, odd steps turn the other. The result is an organic structure resembling seaweed.",
                h_dl_seq: "Sequence Download", p_dl_seq: "Enter a number to calculate its full 'flight' path down to 1.",
                btn_dl_seq: "‚¨á Download (.txt)",
                legal: "Legal Notice", privacy: "Privacy Policy", cookies: "Cookies", contact: "Contact", coffee: "Buy me a coffee"
            },
            'ca': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "PROJECTE COLLATZ", desc: "Visualitzaci√≥ de la Conjectura 3x+1 i art generatiu.",
                lbl_angle: "Angle de Gir:", lbl_len: "Longitud L√≠nia:", lbl_opacity: "Opacitat:",
                btn_draw: "GENERAR ART", btn_color: "üé® COLOR", btn_save: "üíæ IMG HQ",
                txt_note: "Cada l√≠nia representa el 'vol' d'un nombre fins arribar a 1.",
                h_simple: "El Problema m√©s Simple i Impossible",
                p_simple: "La Conjectura de Collatz √©s famosa per ser incre√Øblement f√†cil d'explicar per√≤ impossible de demostrar. Pren qualsevol enter positiu n:",
                p_loop: "Repeteix el proc√©s. La conjectura diu que, sense importar quin nombre tri√Øs, sempre caur√† al bucle infinit 4 ‚Üí 2 ‚Üí 1.",
                h_art: "Com funciona la Visualitzaci√≥?",
                p_art: "Dibuixem el cam√≠ invers. Comencem des de baix i tracem la traject√≤ria de milers de nombres. Si el seg√ºent pas √©s parell, girem a un costat; si √©s imparell, a l'altre. El resultat √©s una estructura org√†nica semblant a algues marines.",
                h_dl_seq: "Desc√†rrega de Seq√º√®ncia", p_dl_seq: "Introdueix un nombre per calcular el seu 'vol' complet fins a 1.",
                btn_dl_seq: "‚¨á Descarregar (.txt)",
                legal: "Av√≠s Legal", privacy: "Privacitat", cookies: "Cookies", contact: "Contacte", coffee: "Convida'm a un caf√®"
            },
            'fr': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "PROJET COLLATZ", desc: "Visualisation de la Conjecture 3x+1 et art g√©n√©ratif.",
                lbl_angle: "Angle de Rotation :", lbl_len: "Longueur Ligne :", lbl_opacity: "Opacit√© :",
                btn_draw: "G√âN√âRER ART", btn_color: "üé® COULEUR", btn_save: "üíæ IMG HQ",
                txt_note: "Chaque ligne repr√©sente le 'vol' d'un nombre jusqu'√† 1.",
                h_simple: "Le Probl√®me Impossible le plus Simple",
                p_simple: "La Conjecture de Collatz est c√©l√®bre pour √™tre incroyablement simple √† expliquer mais impossible √† prouver. Prenez n'importe quel entier positif n :",
                p_loop: "R√©p√©tez le processus. La conjecture dit que peu importe le nombre choisi, il tombera toujours dans la boucle infinie 4 ‚Üí 2 ‚Üí 1.",
                h_art: "Comment fonctionne la Visualisation ?",
                p_art: "Nous dessinons le chemin inverse. En partant du bas, nous tra√ßons la trajectoire de milliers de nombres. Les √©tapes paires tournent d'un c√¥t√©, les impaires de l'autre. Le r√©sultat est une structure organique ressemblant √† des algues.",
                h_dl_seq: "T√©l√©charger S√©quence", p_dl_seq: "Entrez un nombre pour calculer son 'vol' complet jusqu'√† 1.",
                btn_dl_seq: "‚¨á T√©l√©charger (.txt)",
                legal: "Mentions L√©gales", privacy: "Confidentialit√©", cookies: "Cookies", contact: "Contact", coffee: "Offrez-moi un caf√©"
            },
            'de': {
                nav_main: "‚Üê HAUPT-HUB", nav_math: "‚Üê MATH HUB",
                title: "PROJEKT COLLATZ", desc: "Visualisierung der 3x+1 Vermutung und generative Kunst.",
                lbl_angle: "Drehwinkel:", lbl_len: "Linienl√§nge:", lbl_opacity: "Deckkraft:",
                btn_draw: "KUNST GENERIEREN", btn_color: "üé® FARBE", btn_save: "üíæ IMG HQ",
                txt_note: "Jede Linie stellt den 'Flug' einer Zahl dar, bis sie 1 erreicht.",
                h_simple: "Das einfachste unm√∂gliche Problem",
                p_simple: "Die Collatz-Vermutung ist ber√ºhmt daf√ºr, unglaublich einfach zu erkl√§ren, aber unm√∂glich zu beweisen. Nehmen Sie eine beliebige positive ganze Zahl n:",
                p_loop: "Wiederholen Sie den Vorgang. Die Vermutung besagt, dass jede Zahl schlie√ülich in die Endlosschleife 4 ‚Üí 2 ‚Üí 1 f√§llt.",
                h_art: "Wie die Visualisierung funktioniert",
                p_art: "Wir zeichnen den Weg r√ºckw√§rts. Wir beginnen unten und verfolgen die Flugbahn tausender Zahlen. Gerade Schritte drehen sich in eine Richtung, ungerade in die andere. Das Ergebnis ist eine organische Struktur.",
                h_dl_seq: "Sequenz herunterladen", p_dl_seq: "Geben Sie eine Zahl ein, um ihren vollst√§ndigen 'Flug' bis zur 1 zu berechnen.",
                btn_dl_seq: "‚¨á Herunterladen (.txt)",
                legal: "Impressum", privacy: "Datenschutz", cookies: "Cookies", contact: "Kontakt", coffee: "Kauf mir einen Kaffee"
            },
            'pt': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "PROJETO COLLATZ", desc: "Visualiza√ß√£o da Conjectura 3x+1 e arte generativa.",
                lbl_angle: "√Çngulo de Giro:", lbl_len: "Comprimento Linha:", lbl_opacity: "Opacidade:",
                btn_draw: "GERAR ARTE", btn_color: "üé® COR", btn_save: "üíæ IMG HQ",
                txt_note: "Cada linha representa o 'voo' de um n√∫mero at√© chegar a 1.",
                h_simple: "O Problema mais Simples e Imposs√≠vel",
                p_simple: "A Conjectura de Collatz √© famosa por ser incrivelmente f√°cil de explicar, mas imposs√≠vel de provar. Pegue qualquer inteiro positivo n:",
                p_loop: "Repita o processo. A conjectura diz que n√£o importa o n√∫mero que voc√™ escolha, ele sempre cair√° no loop infinito 4 ‚Üí 2 ‚Üí 1.",
                h_art: "Como funciona a Visualiza√ß√£o?",
                p_art: "Desenhamos o caminho inverso. Come√ßando de baixo, tra√ßamos a trajet√≥ria de milhares de n√∫meros. Passos pares giram para um lado, √≠mpares para o outro. O resultado √© uma estrutura org√¢nica semelhante a algas marinhas.",
                h_dl_seq: "Baixar Sequ√™ncia", p_dl_seq: "Digite um n√∫mero para calcular seu 'voo' completo at√© 1.",
                btn_dl_seq: "‚¨á Baixar (.txt)",
                legal: "Aviso Legal", privacy: "Privacidade", cookies: "Cookies", contact: "Contato", coffee: "Pagar um caf√©"
            },
            'it': {
                nav_main: "‚Üê HUB PRINCIPALE", nav_math: "‚Üê HUB MATH",
                title: "PROGETTO COLLATZ", desc: "Visualizzazione della Congettura 3x+1 e arte generativa.",
                lbl_angle: "Angolo di Rotazione:", lbl_len: "Lunghezza Linea:", lbl_opacity: "Opacit√†:",
                btn_draw: "GENERARE ARTE", btn_color: "üé® COLORE", btn_save: "üíæ IMG HQ",
                txt_note: "Ogni linea rappresenta il 'volo' di un numero fino a raggiungere 1.",
                h_simple: "Il Problema pi√π Semplice e Impossibile",
                p_simple: "La Congettura di Collatz √® famosa per essere incredibilmente semplice da spiegare ma impossibile da dimostrare. Prendi un qualsiasi intero positivo n:",
                p_loop: "Ripeti il processo. La congettura dice che, non importa quale numero scegli, cadr√† sempre nel ciclo infinito 4 ‚Üí 2 ‚Üí 1.",
                h_art: "Come funziona la Visualizzazione?",
                p_art: "Disegniamo il percorso inverso. Partendo dal basso, tracciamo la traiettoria di migliaia di numeri. I passi pari girano da una parte, i dispari dall'altra. Il risultato √® una struttura organica.",
                h_dl_seq: "Scarica Sequenza", p_dl_seq: "Inserisci un numero per calcolare il suo 'volo' completo fino a 1.",
                btn_dl_seq: "‚¨á Scarica (.txt)",
                legal: "Note Legali", privacy: "Privacy", cookies: "Cookies", contact: "Contatto", coffee: "Offrimi un caff√®"
            },
            'nl': {
                nav_main: "‚Üê HOOFDHUB", nav_math: "‚Üê MATH HUB",
                title: "PROJECT COLLATZ", desc: "Visualisatie van het 3x+1 Vermoeden en generatieve kunst.",
                lbl_angle: "Draaihoek:", lbl_len: "Lijnlengte:", lbl_opacity: "Ondoorschijnendheid:",
                btn_draw: "KUNST GENEREREN", btn_color: "üé® KLEUR", btn_save: "üíæ IMG HQ",
                txt_note: "Elke lijn vertegenwoordigt de 'vlucht' van een getal tot het 1 bereikt.",
                h_simple: "Het Eenvoudigste Onmogelijke Probleem",
                p_simple: "Het Collatz-vermoeden is beroemd omdat het ongelooflijk eenvoudig uit te leggen is, maar onmogelijk te bewijzen. Neem een positief geheel getal n:",
                p_loop: "Herhaal het proces. Het vermoeden stelt dat welk getal je ook kiest, het altijd in de oneindige lus 4 ‚Üí 2 ‚Üí 1 zal vallen.",
                h_art: "Hoe werkt de Visualisatie?",
                p_art: "We tekenen het pad in omgekeerde volgorde. Vanaf de bodem volgen we het traject van duizenden getallen. Even stappen draaien de ene kant op, oneven stappen de andere. Het resultaat is een organische structuur.",
                h_dl_seq: "Reeks Downloaden", p_dl_seq: "Voer een getal in om de volledige 'vlucht' naar 1 te berekenen.",
                btn_dl_seq: "‚¨á Downloaden (.txt)",
                legal: "Juridisch", privacy: "Privacy", cookies: "Cookies", contact: "Contact", coffee: "Koop koffie"
            },
            'ja': {
                nav_main: "‚Üê „É°„Ç§„É≥„Éè„Éñ", nav_math: "‚Üê Êï∞Â≠¶„Éè„Éñ",
                title: "„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éª„Ç≥„É©„ÉÉ„ÉÑ", desc: "3x+1‰∫àÊÉ≥„ÅÆË¶ñË¶öÂåñ„Å®„Ç∏„Çß„Éç„É¨„Éº„ÉÜ„Ç£„Éñ„Ç¢„Éº„Éà„ÄÇ",
                lbl_angle: "ÂõûËª¢ËßíÂ∫¶:", lbl_len: "Á∑ö„ÅÆÈï∑„Åï:", lbl_opacity: "‰∏çÈÄèÊòéÂ∫¶:",
                btn_draw: "„Ç¢„Éº„ÉàÁîüÊàê", btn_color: "üé® Ëâ≤Â§âÊõ¥", btn_save: "üíæ ÁîªÂÉè‰øùÂ≠ò HQ",
                txt_note: "ÂêÑÁ∑ö„ÅØ„ÄÅ1„Å´Âà∞ÈÅî„Åô„Çã„Åæ„Åß„ÅÆÊï∞Â≠ó„ÅÆ„ÄåÈ£õË°å„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ",
                h_simple: "ÊúÄ„ÇÇÂçòÁ¥î„Åß‰∏çÂèØËÉΩ„Å™ÂïèÈ°å",
                p_simple: "„Ç≥„É©„ÉÉ„ÉÑ‰∫àÊÉ≥„ÅØ„ÄÅË™¨Êòé„Åô„Çã„ÅÆ„ÅØÈùûÂ∏∏„Å´Á∞°Âçò„Åß„Åô„Åå„ÄÅË®ºÊòé„Åô„Çã„ÅÆ„ÅØ‰∏çÂèØËÉΩ„Åß„ÅÇ„Çã„Åì„Å®„ÅßÊúâÂêç„Åß„Åô„ÄÇ‰ªªÊÑè„ÅÆÊ≠£„ÅÆÊï¥Êï∞n„ÇíÂèñ„Çä„Åæ„ÅôÔºö",
                p_loop: "„Éó„É≠„Çª„Çπ„ÇíÁπ∞„ÇäËøî„Åó„Åæ„Åô„ÄÇ‰∫àÊÉ≥„Åß„ÅØ„ÄÅ„Å©„ÅÆÊï∞Â≠ó„ÇíÈÅ∏„Çì„Åß„ÇÇ„ÄÅÂ∏∏„Å´ÁÑ°Èôê„É´„Éº„Éó4 ‚Üí 2 ‚Üí 1„Å´Èô•„Çã„Å®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                h_art: "Ë¶ñË¶öÂåñ„ÅÆ‰ªïÁµÑ„Åø",
                p_art: "ÈÄÜ„ÅÆÁµåË∑Ø„ÇíÊèè„Åç„Åæ„Åô„ÄÇ‰∏ã„Åã„ÇâÂßã„ÇÅ„Å¶„ÄÅ‰ΩïÂçÉ„ÇÇ„ÅÆÊï∞Â≠ó„ÅÆËªåË∑°„Çí„Åü„Å©„Çä„Åæ„Åô„ÄÇÂÅ∂Êï∞„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅØ„ÅÇ„ÇãÊñπÂêë„Å´„ÄÅÂ•áÊï∞„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅØÂà•„ÅÆÊñπÂêë„Å´ÂõûËª¢„Åó„Åæ„Åô„ÄÇ„Åù„ÅÆÁµêÊûú„ÄÅÊµ∑Ëóª„ÅÆ„Çà„ÅÜ„Å™ÊúâÊ©üÁöÑ„Å™ÊßãÈÄ†„ÅåÁîü„Åæ„Çå„Åæ„Åô„ÄÇ",
                h_dl_seq: "„Ç∑„Éº„Ç±„É≥„ÇπDL", p_dl_seq: "Êï∞Â≠ó„ÇíÂÖ•Âäõ„Åó„Å¶„ÄÅ1„Åæ„Åß„ÅÆÂÆåÂÖ®„Å™„ÄåÈ£õË°å„Äç„ÇíË®àÁÆó„Åó„Åæ„Åô„ÄÇ",
                btn_dl_seq: "‚¨á „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ (.txt)",
                legal: "Ê≥ïÁöÑÈÄöÁü•", privacy: "„Éó„É©„Ç§„Éê„Ç∑„Éº", cookies: "„ÇØ„ÉÉ„Ç≠„Éº", contact: "ÈÄ£Áµ°ÂÖà", coffee: "„Ç≥„Éº„Éí„Éº„ÇíÂ•¢„Çã"
            }
        };

        let currentLang = 'es';
        function setLang(lang) {
            localStorage.setItem('gl_lang', lang);
            currentLang = lang;
            const t = translations[lang] || translations['es'];
            
            document.getElementById('nav-main').innerText = t.nav_main;
            document.getElementById('nav-math').innerText = t.nav_math;
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-desc').innerText = t.desc;
            
            document.getElementById('lbl-angle').innerText = t.lbl_angle;
            document.getElementById('lbl-len').innerText = t.lbl_len;
            document.getElementById('lbl-opacity').innerText = t.lbl_opacity;
            
            document.getElementById('btn-draw').innerText = t.btn_draw;
            document.getElementById('btn-color').innerText = t.btn_color;
            document.getElementById('btn-save').innerText = t.btn_save;
            document.getElementById('txt-note').innerText = t.txt_note;

            document.getElementById('info-h-simple').innerText = t.h_simple;
            document.getElementById('info-p-simple').innerText = t.p_simple;
            document.getElementById('info-p-loop').innerText = t.p_loop;
            
            document.getElementById('info-h-art').innerText = t.h_art;
            document.getElementById('info-p-art').innerText = t.p_art;
            
            document.getElementById('h-dl-seq').innerText = t.h_dl_seq;
            document.getElementById('p-dl-seq').innerText = t.p_dl_seq;
            document.getElementById('btn-dl-seq').innerText = t.btn_dl_seq;

            document.getElementById('link-legal').innerText = t.legal;
            document.getElementById('link-privacy').innerText = t.privacy;
            document.getElementById('link-cookies').innerText = t.cookies;
            document.getElementById('link-contact').innerText = t.contact;
            document.getElementById('btn-coffee').innerText = t.coffee;

            document.querySelectorAll('.lang-switch button').forEach(b => {
                b.classList.remove('active');
                if(b.id === 'btn-' + lang) b.classList.add('active');
            });
        }

        // INIT
        const savedLang = localStorage.getItem('gl_lang') || 'es';
        setLang(savedLang);
        setTimeout(drawCollatz, 100);

    </script>
</body>
</html>
