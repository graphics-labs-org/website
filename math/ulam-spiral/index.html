<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ulam Spirals | Graphics Labs</title>
    <style>
        /* --- ESTILOS BASE --- */
        :root {
            --primary: #00ff41; /* Verde Matrix */
            --secondary: #bd00ff;
            --highlight: #ffee00;
            --glass: rgba(20, 20, 20, 0.7);
            --glass-text: rgba(30, 30, 30, 0.8);
            --border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --muted: #aaaaaa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', monospace, sans-serif; }
        
        body {
            background-color: #050505;
            color: var(--text);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            user-select: none;
        }

        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* --- CONTROLES --- */
        .controls {
            background: var(--glass);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin: 20px auto;
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .input-group { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; justify-content: center; }
        
        label { color: var(--muted); font-size: 0.9rem; }

        input[type="number"] {
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 10px;
            border-radius: 5px;
            width: 100px;
            font-size: 1.1rem;
            text-align: center;
        }

        button.action-btn {
            background: var(--primary);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            text-transform: uppercase;
            font-size: 1rem;
        }
        button.action-btn:hover { box-shadow: 0 0 15px var(--primary); transform: scale(1.05); }
        
        button.secondary-btn {
            background: transparent;
            border: 1px solid var(--secondary);
            color: var(--secondary);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        button.secondary-btn:hover { background: var(--secondary); color: #fff; box-shadow: 0 0 15px var(--secondary); }

        /* --- VISUALIZADOR CANVAS --- */
        #canvas-container {
            width: 100%;
            overflow: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            margin-bottom: 20px;
            position: relative;
            z-index: 10;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) #111;
        }
        
        #canvas-container::-webkit-scrollbar { height: 8px; width: 8px; }
        #canvas-container::-webkit-scrollbar-track { background: #111; }
        #canvas-container::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; }

        #ulam-canvas {
            background: #000;
            border: 1px solid var(--border);
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            cursor: crosshair;
            margin-bottom: 10px;
            max-width: 100%;
        }

        /* --- INFO & ADS --- */
        .info-section {
            background: var(--glass-text);
            padding: 40px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin: 40px auto;
            max-width: 900px;
            text-align: left;
            line-height: 1.8;
            color: #ddd;
        }
        .info-section h2 { color: var(--primary); margin-bottom: 20px; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-top: 40px; }
        .info-section h2:first-child { margin-top: 0; }
        .info-section p { margin-bottom: 20px; font-size: 1rem; text-align: justify; }
        .math-highlight { color: var(--highlight); font-family: monospace; background: rgba(255, 238, 0, 0.1); padding: 2px 5px; border-radius: 3px; }

        /* ASCII Art Box */
        .ascii-box {
            background: rgba(0, 0, 0, 0.4);
            border: 1px dashed var(--primary);
            color: var(--primary);
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 6px;
            white-space: pre;
            overflow-x: auto;
            margin: 20px 0;
            text-align: center;
            font-size: 0.9rem;
            line-height: 1.2;
        }

        .ad-container {
            width: 100%;
            max-width: 728px;
            margin: 30px auto;
            min-height: 90px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px dashed rgba(255,255,255,0.1); 
            border-radius: 8px;
            background: rgba(0,0,0,0.2);
        }
        .ad-placeholder-text { color: var(--border); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; }

        /* Nav & Footer */
        nav { display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .nav-links { display: flex; gap: 15px; }
        .nav-btn { text-decoration: none; color: var(--muted); font-size: 0.9rem; border: 1px solid var(--border); padding: 5px 10px; border-radius: 4px; transition: 0.3s; background: rgba(0,0,0,0.5); }
        .nav-btn:hover { color: var(--primary); border-color: var(--primary); }
        .logo { font-size: 1.2rem; font-weight: bold; color: var(--primary); text-decoration: none; letter-spacing: 2px; }
        
        .lang-switch button { background: rgba(0,0,0,0.5); border: 1px solid var(--border); color: var(--muted); padding: 5px 10px; cursor: pointer; border-radius: 4px; margin-left: 2px;}
        .lang-switch button.active { background: var(--primary); color: #000; }
        
        footer { margin-top: auto; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); border-top: 1px solid var(--border); padding: 30px 20px; text-align: center; font-size: 0.8rem; color: var(--muted); display: flex; flex-direction: column; gap: 15px; align-items: center; position: relative; z-index: 20; }
        .legal-links { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; margin-bottom: 10px; }
        .legal-links a { color: var(--muted); text-decoration: none; transition: 0.3s; border-bottom: 1px solid transparent; }
        .legal-links a:hover { color: var(--primary); border-bottom-color: var(--primary); }

        .coffee-btn { background: linear-gradient(45deg, #FFDD00, #FBB03B); color: #000; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-weight: bold; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 5px; transition: transform 0.2s; }
        .coffee-btn:hover { transform: scale(1.05); }

    </style>
</head>
<body oncontextmenu="return false;">

    <canvas id="bg-canvas"></canvas>

    <div class="container">
        <nav>
            <div class="nav-links">
                <a href="../../index.html" class="nav-btn" id="nav-main">‚Üê HUB PRINCIPAL</a>
                <a href="../index.html" class="nav-btn" id="nav-math">‚Üê HUB MATH</a>
            </div>
            <div class="logo">GRAPHICS LABS</div>
            <div class="lang-switch">
                <button onclick="setLang('es')" id="btn-es" class="active">ES</button>
                <button onclick="setLang('ca')" id="btn-ca">CA</button>
                <button onclick="setLang('en')" id="btn-en">EN</button>
                <button onclick="setLang('fr')" id="btn-fr">FR</button>
                <button onclick="setLang('de')" id="btn-de">DE</button>
                <button onclick="setLang('pt')" id="btn-pt">PT</button>
                <button onclick="setLang('it')" id="btn-it">IT</button>
                <button onclick="setLang('nl')" id="btn-nl">NL</button>
                <button onclick="setLang('ja')" id="btn-ja">JP</button>
            </div>
        </nav>

        <h1 id="txt-title">ESPIRAL DE ULAM</h1>
        <p style="color:var(--muted); margin-bottom: 20px;" id="txt-desc">Visualizaci√≥n de la distribuci√≥n de n√∫meros primos en un patr√≥n en espiral.</p>

        <div class="controls">
            <div class="input-group">
                <div>
                    <label id="lbl-max">M√°ximo (N):</label><br>
                    <input type="number" id="inp-max" value="40000" min="100" max="1000000" step="1000">
                </div>
                <div>
                    <label id="lbl-zoom">Zoom (px):</label><br>
                    <input type="number" id="inp-zoom" value="2" min="1" max="10">
                </div>
                <div>
                    <label id="lbl-start">Inicio:</label><br>
                    <input type="number" id="inp-start" value="1" min="1">
                </div>
            </div>
            <div class="input-group">
                <button class="action-btn" onclick="generateSpiral()" id="btn-gen">GENERAR</button>
                <button class="secondary-btn" onclick="saveImage()" id="btn-save">üíæ JPG</button>
            </div>
        </div>

        <div id="canvas-container">
            <canvas id="ulam-canvas" width="800" height="800"></canvas>
            <p style="color:var(--muted); font-size: 0.8rem; margin-top:5px;" id="txt-canvas-note">Usa el bot√≥n GUARDAR JPG para descargar tu imagen.</p>
        </div>

        <div class="info-section">
            <h2 id="info-h-history">El Hallazgo Accidental</h2>
            <p id="info-p1">
                En 1963, el matem√°tico polaco <strong>Stanislaw Ulam</strong> se encontraba en una reuni√≥n cient√≠fica. Presa del aburrimiento, comenz√≥ a garabatear n√∫meros enteros consecutivos en una cuadr√≠cula, empezando por el 1 en el centro y movi√©ndose en espiral hacia afuera. Instintivamente, marc√≥ los <span class="math-highlight">n√∫meros primos</span>.
            </p>
            
            <h2 id="info-h-why">¬øPor qu√© se llama "Espiral" si no veo una espiral?</h2>
            <p id="info-p-why-1">
                Es una pregunta excelente y es la confusi√≥n n√∫mero uno con este gr√°fico. La "espiral" es el m√©todo de construcci√≥n (el camino invisible), no el resultado final visible. Imagina que dibujas una l√≠nea conectando todos los n√∫meros naturales en orden (1, 2, 3...) saliendo del centro. Si haces eso, ver√≠as una espiral cuadrada perfecta:
            </p>

            <div class="ascii-box">
17--16--15--14--13
|                |
18   5---4---3  12
|    |       |   |
19   6   1---2  11
|    |           |
20   7---8---9--10</div>

            <p id="info-p-why-2">
                En la visualizaci√≥n final (tu imagen), borramos la l√≠nea de la espiral y apagamos los n√∫meros compuestos (4, 6, 8...), dejando encendida la luz solo en los <strong>N√∫meros Primos</strong> (2, 3, 5, 7, 11...). Lo sorprendente es que, al borrar la estructura, los n√∫meros primos (que deber√≠an ser aleatorios) se quedan formando l√≠neas diagonales.
            </p>
            <p id="info-p-why-summary" style="color: var(--highlight); font-weight: bold;">
                En resumen: Se llama "Espiral de Ulam" por c√≥mo se colocan los asientos del teatro, no por d√≥nde se sienta la gente.
            </p>

            <h2 id="info-h-math">La Matem√°tica del Patr√≥n</h2>
            <p id="info-p3">
                Las l√≠neas diagonales, horizontales y verticales visibles corresponden a polinomios cuadr√°ticos. Por ejemplo, la diagonal m√°s prominente a menudo se relaciona con el famoso polinomio de Euler: <span class="math-highlight">f(n) = n¬≤ + n + 41</span>, que genera una densidad inusualmente alta de n√∫meros primos.
            </p>
            <p id="info-p4">
                En esta herramienta de <strong>Graphics Labs</strong>, cada punto verde brillante representa un n√∫mero primo. Al aumentar el n√∫mero "M√°ximo (N)" y reducir el "Zoom", puedes observar estructuras a gran escala que se asemejan a galaxias o circuitos integrados.
            </p>
        </div>

        <div class="ad-container"><span class="ad-placeholder-text">Ad Space</span></div>
    </div>

    <footer>
        <div class="legal-links">
            <a href="../../legal.html" id="link-legal">Aviso Legal</a>
            <a href="../../privacy.html" id="link-privacy">Pol√≠tica de Privacidad</a>
            <a href="../../cookies.html" id="link-cookies">Pol√≠tica de Cookies</a>
            <a href="mailto:pbazan@gmail.com" id="link-contact">Contacto</a>
        </div>
        <span id="footer-rights">¬© 2025 Graphics Labs</span>
        <a href="https://paypal.me/pbazan" target="_blank" class="coffee-btn">
            ‚òï <span id="btn-coffee">Inv√≠tame a un caf√©</span>
        </a>
    </footer>

<script>
        /* --- 1. SEGURIDAD --- */
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
                e.preventDefault();
            }
        });

        /* --- 2. TRADUCCIONES --- */
        const translations = {
            'es': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "ESPIRAL DE ULAM", desc: "Visualizaci√≥n de la distribuci√≥n de n√∫meros primos en un patr√≥n en espiral.",
                lbl_max: "M√°ximo (N):", lbl_zoom: "Grosor (px):", lbl_start: "N√∫mero Inicio:",
                btn_gen: "GENERAR", btn_save: "GUARDAR HD (PNG)",
                canvas_note: "El bot√≥n GUARDAR genera una imagen de Alta Definici√≥n (3x) en formato PNG.",
                history_title: "El Hallazgo Accidental",
                p1: "En 1963, el matem√°tico Stanislaw Ulam descubri√≥ este patr√≥n por aburrimiento en una reuni√≥n. Al escribir n√∫meros en espiral y marcar los primos, not√≥ alineaciones diagonales.",
                why_title: "¬øPor qu√© se llama 'Espiral' si no veo una espiral?",
                p_why_1: "La 'espiral' es el m√©todo de construcci√≥n (el camino invisible), no el resultado visible. Imagina una l√≠nea conectando todos los n√∫meros naturales (1, 2, 3...) saliendo del centro. Si vi√©ramos todos los n√∫meros, ver√≠amos esa espiral cuadrada perfecta.",
                p_why_2: "En la imagen final borramos la l√≠nea y apagamos los n√∫meros compuestos, dejando solo los Primos. Lo sorprendente es que, al borrar la estructura, los primos forman diagonales.",
                p_why_summary: "En resumen: Se llama 'Espiral de Ulam' por c√≥mo se colocan los asientos del teatro, no por d√≥nde se sienta la gente.",
                math_title: "La Matem√°tica del Patr√≥n",
                p3: "Las diagonales corresponden a polinomios como el de Euler: n¬≤ + n + 41. Esta herramienta permite visualizar estas 'galaxias matem√°ticas'.",
                p4: "Aumenta el n√∫mero m√°ximo para ver la estructura a gran escala.",
                legal: "Aviso Legal", privacy: "Pol√≠tica de Privacidad", cookies: "Cookies", contact: "Contacto", coffee: "Inv√≠tame a un caf√©"
            },
            'en': {
                nav_main: "‚Üê MAIN HUB", nav_math: "‚Üê MATH HUB",
                title: "ULAM SPIRAL", desc: "Visualization of prime number distribution in a spiral pattern.",
                lbl_max: "Maximum (N):", lbl_zoom: "Dot Size:", lbl_start: "Start Num:",
                btn_gen: "GENERATE", btn_save: "SAVE HD (PNG)",
                canvas_note: "The SAVE button generates a High Definition image (3x) in PNG format.",
                history_title: "The Accidental Discovery",
                p1: "In 1963, mathematician Stanislaw Ulam discovered this pattern while doodling during a boring meeting. Marking primes in a number spiral revealed diagonal alignments.",
                why_title: "Why is it called 'Spiral' if I don't see one?",
                p_why_1: "The 'spiral' is the construction method (the invisible path), not the visible result. Imagine a line connecting all natural numbers (1, 2, 3...) spiraling out from the center. If we saw all numbers, we would see that square spiral.",
                p_why_2: "In the final image, we erase the line and turn off composite numbers, leaving only Primes. Surprisingly, when the structure is removed, primes form diagonal lines.",
                p_why_summary: "In short: It's called 'Ulam Spiral' because of how the theater seats are arranged, not where people sit.",
                math_title: "The Mathematics",
                p3: "Diagonals correspond to polynomials like Euler's n¬≤ + n + 41. This tool lets you visualize these 'math galaxies'.",
                p4: "Increase the maximum number to see large-scale structures.",
                legal: "Legal Notice", privacy: "Privacy Policy", cookies: "Cookies", contact: "Contact", coffee: "Buy me a coffee"
            },
            'ca': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "ESPIRAL D'ULAM", desc: "Visualitzaci√≥ de la distribuci√≥ de nombres primers en un patr√≥ en espiral.",
                lbl_max: "M√†xim (N):", lbl_zoom: "Gruix (px):", lbl_start: "Nombre Inici:",
                btn_gen: "GENERAR", btn_save: "DESAR HD (PNG)",
                canvas_note: "El bot√≥ DESAR genera una imatge d'Alta Definici√≥ (3x) en format PNG.",
                history_title: "La Troballa Accidental",
                p1: "El 1963, el matem√†tic Stanislaw Ulam va descobrir aquest patr√≥ per avorriment. En escriure nombres en espiral i marcar els primers, va notar alineacions diagonals.",
                why_title: "Per qu√® es diu 'Espiral' si no en veig cap?",
                p_why_1: "L'espiral √©s el m√®tode de construcci√≥ (el cam√≠ invisible), no el resultat visible. Imagina una l√≠nia connectant tots els nombres naturals sortint del centre. Si vei√©ssim tots els nombres, veur√≠em aquesta espiral quadrada.",
                p_why_2: "En la imatge final esborrem la l√≠nia i apaguem els nombres compostos, deixant nom√©s els Primers. El sorprenent √©s que, en esborrar l'estructura, els primers formen diagonals.",
                p_why_summary: "En resum: Es diu 'Espiral d'Ulam' per com es col¬∑loquen els seients del teatre, no per on seu la gent.",
                math_title: "La Matem√†tica del Patr√≥",
                p3: "Les diagonals corresponen a polinomis com el d'Euler: n¬≤ + n + 41. Aquesta eina permet visualitzar aquestes 'gal√†xies matem√†tiques'.",
                p4: "Augmenta el nombre m√†xim per veure l'estructura a gran escala.",
                legal: "Av√≠s Legal", privacy: "Pol√≠tica de Privacitat", cookies: "Cookies", contact: "Contacte", coffee: "Convida'm a un caf√®"
            },
            'fr': { nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH", title: "SPIRALE D'ULAM", desc: "Visualisation de la distribution des nombres premiers.", lbl_max: "Maximum (N):", lbl_zoom: "Zoom (px):", lbl_start: "D√©but:", btn_gen: "G√âN√âRER", btn_save: "HD (PNG)", canvas_note: "Image haute d√©finition (3x) PNG.", history_title: "La D√©couverte Accidentelle", p1: "D√©couvert par Ulam en 1963.", why_title: "Pourquoi une 'Spirale' ?", p_why_1: "La spirale est la m√©thode de construction invisible.", p_why_2: "Seuls les nombres premiers restent visibles.", p_why_summary: "L'arrangement des si√®ges, pas les spectateurs.", math_title: "Les Math√©matiques", p3: "Polyn√¥me d'Euler.", p4: "Augmentez le maximum.", legal: "Mentions", privacy: "Confidentialit√©", cookies: "Cookies", contact: "Contact", coffee: "Caf√©" },
            'de': { nav_main: "‚Üê HAUPT-HUB", nav_math: "‚Üê MATH HUB", title: "ULAM-SPIRALE", desc: "Visualisierung der Primzahlverteilung.", lbl_max: "Maximum (N):", lbl_zoom: "Zoom (px):", lbl_start: "Start:", btn_gen: "GENERIEREN", btn_save: "HD (PNG)", canvas_note: "Hochaufl√∂sendes Bild (3x) PNG.", history_title: "Die zuf√§llige Entdeckung", p1: "1963 von Ulam entdeckt.", why_title: "Warum 'Spirale'?", p_why_1: "Die Spirale ist unsichtbar.", p_why_2: "Nur Primzahlen sind sichtbar.", p_why_summary: "Sitzordnung, nicht Zuschauer.", math_title: "Mathematik", p3: "Euler-Polynom.", p4: "Maximum erh√∂hen.", legal: "Impressum", privacy: "Datenschutz", cookies: "Cookies", contact: "Kontakt", coffee: "Kaffee" },
            'pt': { nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH", title: "ESPIRAL DE ULAM", desc: "Visualiza√ß√£o dos primos.", lbl_max: "M√°ximo (N):", lbl_zoom: "Zoom (px):", lbl_start: "In√≠cio:", btn_gen: "GERAR", btn_save: "HD (PNG)", canvas_note: "Imagem Alta Defini√ß√£o (3x) PNG.", history_title: "Descoberta", p1: "Descoberto por Ulam em 1963.", why_title: "Por que 'Espiral'?", p_why_1: "M√©todo de constru√ß√£o invis√≠vel.", p_why_2: "Apenas primos vis√≠veis.", p_why_summary: "Assentos do teatro, n√£o as pessoas.", math_title: "Matem√°tica", p3: "Polin√¥mio de Euler.", p4: "Aumente o m√°ximo.", legal: "Aviso", privacy: "Privacidade", cookies: "Cookies", contact: "Contato", coffee: "Caf√©" },
            'it': { nav_main: "‚Üê HUB PRINCIPALE", nav_math: "‚Üê HUB MATH", title: "SPIRALE DI ULAM", desc: "Visualizzazione dei numeri primi.", lbl_max: "Massimo (N):", lbl_zoom: "Zoom (px):", lbl_start: "Inizio:", btn_gen: "GENERARE", btn_save: "HD (PNG)", canvas_note: "Immagine Alta Definizione (3x) PNG.", history_title: "Scoperta", p1: "Scoperto da Ulam nel 1963.", why_title: "Perch√© 'Spirale'?", p_why_1: "Metodo di costruzione invisibile.", p_why_2: "Solo i primi sono visibili.", p_why_summary: "Posti a sedere, non persone.", math_title: "Matematica", p3: "Polinomio di Eulero.", p4: "Aumenta il massimo.", legal: "Legale", privacy: "Privacy", cookies: "Cookies", contact: "Contatto", coffee: "Caff√®" },
            'nl': { nav_main: "‚Üê HOOFDHUB", nav_math: "‚Üê MATH HUB", title: "ULAM SPIRAAL", desc: "Visualisatie van priemgetallen.", lbl_max: "Maximum (N):", lbl_zoom: "Zoom (px):", lbl_start: "Start:", btn_gen: "GENEREREN", btn_save: "HD (PNG)", canvas_note: "Hoge resolutie afbeelding (3x) PNG.", history_title: "Ontdekking", p1: "Ontdekt door Ulam in 1963.", why_title: "Waarom 'Spiraal'?", p_why_1: "Onzichtbare bouwmethode.", p_why_2: "Alleen priemgetallen zichtbaar.", p_why_summary: "Stoelopstelling, niet mensen.", math_title: "Wiskunde", p3: "Euler's Polynoom.", p4: "Verhoog maximum.", legal: "Juridisch", privacy: "Privacy", cookies: "Cookies", contact: "Contact", coffee: "Koffie" },
            'ja': { nav_main: "‚Üê „É°„Ç§„É≥„Éè„Éñ", nav_math: "‚Üê Êï∞Â≠¶„Éè„Éñ", title: "„Ç¶„É©„É†„ÅÆËû∫Êóã", desc: "Á¥†Êï∞„ÅÆÂèØË¶ñÂåñ„ÄÇ", lbl_max: "ÊúÄÂ§ßÂÄ§ (N):", lbl_zoom: "„Ç∫„Éº„É†:", lbl_start: "ÈñãÂßã:", btn_gen: "ÁîüÊàê", btn_save: "HD‰øùÂ≠ò(PNG)", canvas_note: "È´òËß£ÂÉèÂ∫¶ÁîªÂÉè (3x) PNG.", history_title: "Áô∫Ë¶ã", p1: "1963Âπ¥„Å´Áô∫Ë¶ã„ÄÇ", why_title: "„Å™„ÅúËû∫ÊóãÔºü", p_why_1: "ÊßãÁØâÊñπÊ≥ï„ÅØËû∫Êóã„ÄÇ", p_why_2: "Á¥†Êï∞„ÅÆ„ÅøË°®Á§∫„ÄÇ", p_why_summary: "Â∫ßÂ∏≠ÈÖçÁΩÆ„ÄÇ", math_title: "Êï∞Â≠¶", p3: "„Ç™„Ç§„É©„Éº„ÅÆÂ§öÈ†ÖÂºè„ÄÇ", p4: "ÊúÄÂ§ßÂÄ§„ÇíÂ¢ó„ÇÑ„Åô„ÄÇ", legal: "Ê≥ïÁöÑ", privacy: "„Éó„É©„Ç§„Éê„Ç∑„Éº", cookies: "„ÇØ„ÉÉ„Ç≠„Éº", contact: "ÈÄ£Áµ°ÂÖà", coffee: "„Ç≥„Éº„Éí„Éº" }
        };

        let currentLang = 'es';

        function setLang(lang) {
            localStorage.setItem('gl_lang', lang);
            currentLang = lang;
            const t = translations[lang] || translations['es'];
            
            document.getElementById('nav-main').innerText = t.nav_main;
            document.getElementById('nav-math').innerText = t.nav_math;
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-desc').innerText = t.desc;
            document.getElementById('lbl-max').innerText = t.lbl_max;
            document.getElementById('lbl-zoom').innerText = t.lbl_zoom;
            document.getElementById('lbl-start').innerText = t.lbl_start;
            document.getElementById('btn-gen').innerText = t.btn_gen;
            document.getElementById('btn-save').innerText = t.btn_save;
            document.getElementById('txt-canvas-note').innerText = t.canvas_note;

            document.getElementById('info-h-history').innerText = t.history_title;
            document.getElementById('info-p1').innerText = t.p1;
            document.getElementById('info-h-why').innerText = t.why_title;
            document.getElementById('info-p-why-1').innerText = t.p_why_1;
            document.getElementById('info-p-why-2').innerText = t.p_why_2;
            document.getElementById('info-p-why-summary').innerText = t.p_why_summary;
            document.getElementById('info-h-math').innerText = t.math_title;
            document.getElementById('info-p3').innerText = t.p3;
            document.getElementById('info-p4').innerText = t.p4;

            document.getElementById('link-legal').innerText = t.legal;
            document.getElementById('link-privacy').innerText = t.privacy;
            document.getElementById('link-cookies').innerText = t.cookies;
            document.getElementById('link-contact').innerText = t.contact;
            document.getElementById('btn-coffee').innerText = t.coffee;

            document.querySelectorAll('.lang-switch button').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + lang).classList.add('active');
        }

        /* --- 3. FONDO DE PART√çCULAS (MOVIMIENTO CONTINUO) --- */
        const bgCanvas = document.getElementById('bg-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        let particlesArray = [];
        
        function resizeBg() {
            bgCanvas.width = window.innerWidth;
            bgCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', () => { resizeBg(); initParticles(); });
        resizeBg();

        const mouse = { x: null, y: null, radius: 150 };
        window.addEventListener('mousemove', (e) => { mouse.x = e.x; mouse.y = e.y; });

        class Particle {
            constructor() {
                this.x = Math.random() * bgCanvas.width;
                this.y = Math.random() * bgCanvas.height;
                this.size = Math.random() * 12 + 8;
                this.speedX = (Math.random() * 1) - 0.5;
                this.speedY = (Math.random() * 1) - 0.5;
                this.density = (Math.random() * 30) + 1;
                const symbols = ['œÄ', '‚àû', '‚àë', '‚à´', '‚àö', '‚âà', '‚â†', '0', '1', 'e', 'x', 'y'];
                this.text = symbols[Math.floor(Math.random() * symbols.length)];
            }
            draw() {
                bgCtx.font = this.size + 'px monospace';
                bgCtx.fillStyle = 'rgba(0, 255, 65, 0.15)'; 
                bgCtx.fillText(this.text, this.x, this.y);
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;

                if (mouse.x != null) {
                    let dx = mouse.x - this.x;
                    let dy = mouse.y - this.y;
                    let distance = Math.sqrt(dx*dx + dy*dy);
                    if (distance < mouse.radius) {
                        const forceDirectionX = dx / distance;
                        const forceDirectionY = dy / distance;
                        const force = (mouse.radius - distance) / mouse.radius;
                        const directionX = forceDirectionX * force * this.density;
                        const directionY = forceDirectionY * force * this.density;
                        this.x -= directionX;
                        this.y -= directionY;
                    }
                }

                if (this.x > bgCanvas.width) this.x = 0;
                if (this.x < 0) this.x = bgCanvas.width;
                if (this.y > bgCanvas.height) this.y = 0;
                if (this.y < 0) this.y = bgCanvas.height;

                this.draw();
            }
        }

        function initParticles() {
            particlesArray = [];
            let numberOfParticles = (bgCanvas.height * bgCanvas.width) / 9000;
            for (let i = 0; i < numberOfParticles; i++) {
                particlesArray.push(new Particle());
            }
        }
        
        function animateParticles() {
            bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
            for (let i = 0; i < particlesArray.length; i++) {
                particlesArray[i].update();
            }
            requestAnimationFrame(animateParticles);
        }
        initParticles();
        animateParticles();

        /* --- 4. L√ìGICA ESPIRAL DE ULAM (CORE & HD PNG EXPORT) --- */
        const ulamCanvas = document.getElementById('ulam-canvas');
        const ctx = ulamCanvas.getContext('2d');

        function isPrime(num) {
            if (num <= 1) return false;
            if (num <= 3) return true;
            if (num % 2 === 0 || num % 3 === 0) return false;
            for (let i = 5; i * i <= num; i += 6) {
                if (num % i === 0 || num % (i + 2) === 0) return false;
            }
            return true;
        }

        /**
         * Funci√≥n maestra de dibujo. 
         * Sirve tanto para pintar en pantalla (scale=1) 
         * como para generar el PNG gigante (scale=3).
         */
        function renderSpiral(targetCtx, width, height, max, start, zoom, scaleFactor) {
            // Fondo negro puro (ideal para PNG)
            targetCtx.fillStyle = '#000000';
            targetCtx.fillRect(0, 0, width, height);
            
            // Color de los primos (Verde Matrix)
            targetCtx.fillStyle = '#00ff41';

            let x = Math.floor(width / 2);
            let y = Math.floor(height / 2);
            
            // Ajustar el movimiento seg√∫n el factor de escala
            const stepSize = zoom * scaleFactor; 

            const dx = [1, 0, -1, 0];
            const dy = [0, -1, 0, 1];
            let dir = 0;

            let stepsInSegment = 1;
            let stepsTaken = 0;
            let turnCounter = 0;

            let currentNum = start;

            for (let i = 0; i < max; i++) {
                // Verificar l√≠mites (optimizaci√≥n)
                if (x >= -stepSize && x <= width + stepSize && y >= -stepSize && y <= height + stepSize) {
                    if (isPrime(currentNum)) {
                        if (zoom === 1 && scaleFactor === 1) {
                            targetCtx.fillRect(x, y, 1, 1);
                        } else {
                            targetCtx.beginPath();
                            const radius = (zoom * scaleFactor) / 2.5; 
                            const centerX = x + (stepSize / 2);
                            const centerY = y + (stepSize / 2);
                            
                            targetCtx.arc(centerX, centerY, radius, 0, Math.PI*2);
                            targetCtx.fill();
                        }
                    }
                }

                x += dx[dir] * stepSize;
                y += dy[dir] * stepSize;
                
                currentNum++;
                stepsTaken++;

                if (stepsTaken === stepsInSegment) {
                    stepsTaken = 0;
                    dir = (dir + 1) % 4;
                    turnCounter++;
                    if (turnCounter % 2 === 0) {
                        stepsInSegment++;
                    }
                }
            }
        }

        // 1. Generar en Pantalla (Resoluci√≥n normal)
        function generateSpiral() {
            let max = parseInt(document.getElementById('inp-max').value);
            let start = parseInt(document.getElementById('inp-start').value);
            let zoom = parseInt(document.getElementById('inp-zoom').value);
            
            if (max < 100) max = 100;
            if (zoom < 1) zoom = 1;
            
            // Calcular dimensiones
            const spiralSide = Math.ceil(Math.sqrt(max));
            const canvasSize = (spiralSide * zoom) + (zoom * 20); 

            // Limitar tama√±o visual en pantalla
            const MAX_SCREEN_DIM = 4000;
            let finalW = canvasSize;
            if (finalW > MAX_SCREEN_DIM) finalW = MAX_SCREEN_DIM;

            ulamCanvas.width = finalW;
            ulamCanvas.height = finalW;

            renderSpiral(ctx, finalW, finalW, max, start, zoom, 1);
        }

        // 2. Generar para Descarga (Alta Resoluci√≥n 3x PNG)
        function saveImage() {
            // Leer valores actuales
            let max = parseInt(document.getElementById('inp-max').value);
            let start = parseInt(document.getElementById('inp-start').value);
            let zoom = parseInt(document.getElementById('inp-zoom').value);

            // Factor de Alta Definici√≥n
            const HD_SCALE = 3; 

            // Calcular tama√±o HD
            const spiralSide = Math.ceil(Math.sqrt(max));
            const baseSize = (spiralSide * zoom) + (zoom * 20);
            
            // Crear canvas temporal en memoria
            const tempCanvas = document.createElement('canvas');
            const hdSize = baseSize * HD_SCALE;
            
            // Limite de seguridad
            const MAX_EXPORT_DIM = 12000; 
            const finalHdSize = (hdSize > MAX_EXPORT_DIM) ? MAX_EXPORT_DIM : hdSize;

            tempCanvas.width = finalHdSize;
            tempCanvas.height = finalHdSize;
            const tempCtx = tempCanvas.getContext('2d');

            // Dibujar en el canvas oculto
            renderSpiral(tempCtx, finalHdSize, finalHdSize, max, start, zoom, HD_SCALE);

            // Descargar como PNG
            const link = document.createElement('a');
            link.download = `ulam_spiral_HD_${max}.png`;
            link.href = tempCanvas.toDataURL('image/png'); // Formato PNG (sin p√©rdida)
            link.click();
        }

        // Inicializar
        const saved = localStorage.getItem('gl_lang') || 'es';
        setLang(saved);
        setTimeout(generateSpiral, 100); 

    </script>

</body>
</html>
