<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Fourier | Graphics Labs</title>
    <meta name="description" content="Visualizaci√≥n de Series de Fourier y Epiciclos.">
    <style>
        /* --- ESTILOS BASE --- */
        :root {
            --primary: #00ff41; 
            --primary-dim: rgba(0, 255, 65, 0.3);
            --secondary: #bd00ff;
            --highlight: #ffee00;
            --glass: rgba(20, 20, 20, 0.7);
            --glass-text: rgba(30, 30, 30, 0.8);
            --border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --muted: #aaaaaa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', monospace, sans-serif; }
        
        body {
            background-color: #050505;
            color: var(--text);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            user-select: none;
            /* Evita el efecto de rebote en m√≥viles modernos */
            overscroll-behavior: none; 
        }

        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* --- CONTROLES --- */
        .controls {
            background: var(--glass);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin: 20px auto;
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .buttons-row { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-top: 10px; width: 100%; }

        button.action-btn {
            background: var(--primary); color: #000; border: none; padding: 10px 20px; border-radius: 5px;
            cursor: pointer; font-weight: bold; transition: 0.3s; text-transform: uppercase; font-size: 0.9rem;
            min-width: 150px;
        }
        button.action-btn:hover { box-shadow: 0 0 15px var(--primary); transform: scale(1.05); }
        
        button.secondary-btn {
            background: transparent; border: 1px solid var(--secondary); color: var(--secondary);
            padding: 8px 15px; border-radius: 5px; cursor: pointer; transition: 0.3s; font-size: 0.9rem;
            display: flex; align-items: center; gap: 5px;
        }
        button.secondary-btn:hover { background: var(--secondary); color: #fff; box-shadow: 0 0 15px var(--secondary); }

        /* --- VISUALIZADOR --- */
        #canvas-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            margin-bottom: 20px;
            position: relative;
            z-index: 10;
        }

        #fourier-canvas {
            background: #000;
            border: 1px solid var(--border);
            border-radius: 4px;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.1);
            max-width: 100%;
            cursor: crosshair;
            /* Importante para m√≥viles: evita acciones t√°ctiles del navegador sobre el canvas */
            touch-action: none; 
        }

        .status-text {
            color: var(--highlight);
            font-family: 'Courier New', monospace;
            margin-top: 10px;
            height: 20px;
        }

        /* --- INFO --- */
        .info-section {
            background: var(--glass-text);
            padding: 40px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin: 40px auto;
            max-width: 900px;
            text-align: left;
            line-height: 1.8;
            color: #ddd;
        }
        .info-section h2 { color: var(--primary); margin-bottom: 20px; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-top: 40px; }
        .info-section h2:first-child { margin-top: 0; }
        .info-section p { margin-bottom: 20px; font-size: 1rem; text-align: justify; }
        
        .math-box {
            background: rgba(0,0,0,0.5);
            border-left: 4px solid var(--secondary);
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            color: var(--secondary);
            font-size: 1.1rem;
            line-height: 1.6;
            text-align: center;
        }

        .dl-section { margin-top: 30px; border-top: 1px dashed var(--border); padding-top: 20px; text-align: center; }
        
        .btn-txt-dl {
            display: inline-block; background: rgba(255, 255, 255, 0.1); color: var(--muted); text-decoration: none;
            padding: 15px 25px; border: 1px solid var(--muted); border-radius: 4px; font-family: var(--font-mono);
            font-size: 0.9rem; transition: 0.3s; cursor: pointer;
        }
        .btn-txt-dl:hover { background: var(--secondary); color: #000; border-color: var(--secondary); box-shadow: 0 0 10px var(--secondary); }

        .ad-container {
            width: 100%; max-width: 728px; margin: 30px auto; min-height: 90px;
            display: flex; justify-content: center; align-items: center;
            border: 1px dashed rgba(255,255,255,0.1); border-radius: 8px; background: rgba(0,0,0,0.2);
        }
        .ad-placeholder-text { color: var(--border); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; }

        /* Nav & Footer */
        nav { display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .nav-links { display: flex; gap: 15px; }
        .nav-btn { text-decoration: none; color: var(--muted); font-size: 0.9rem; border: 1px solid var(--border); padding: 5px 10px; border-radius: 4px; transition: 0.3s; background: rgba(0,0,0,0.5); }
        .nav-btn:hover { color: var(--primary); border-color: var(--primary); }
        .logo { font-size: 1.2rem; font-weight: bold; color: var(--primary); text-decoration: none; letter-spacing: 2px; }
        .lang-switch button { background: rgba(0,0,0,0.5); border: 1px solid var(--border); color: var(--muted); padding: 5px 10px; cursor: pointer; border-radius: 4px; margin-left: 2px;}
        .lang-switch button.active { background-color: var(--primary) !important; color: #000 !important; border-color: var(--primary) !important; font-weight: bold; }
        footer { margin-top: auto; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); border-top: 1px solid var(--border); padding: 30px 20px; text-align: center; font-size: 0.8rem; color: var(--muted); display: flex; flex-direction: column; gap: 15px; align-items: center; position: relative; z-index: 20; }
        .legal-links { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; margin-bottom: 10px; }
        .legal-links a { color: var(--muted); text-decoration: none; transition: 0.3s; border-bottom: 1px solid transparent; }
        .legal-links a:hover { color: var(--primary); border-bottom-color: var(--primary); }
        .coffee-btn { background: linear-gradient(45deg, #FFDD00, #FBB03B); color: #000; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-weight: bold; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 5px; transition: transform 0.2s; }
        .coffee-btn:hover { transform: scale(1.05); }

    </style>
</head>
<body oncontextmenu="return false;">

    <canvas id="bg-canvas"></canvas>

    <div class="container">
        <nav>
            <div class="nav-links">
                <a href="../../index.html" class="nav-btn" id="nav-main">‚Üê HUB PRINCIPAL</a>
                <a href="../index.html" class="nav-btn" id="nav-math">‚Üê HUB MATH</a>
            </div>
            <div class="logo">GRAPHICS LABS</div>
            <div class="lang-switch">
                <button onclick="setLang('es')" id="btn-es" class="active">ES</button>
                <button onclick="setLang('ca')" id="btn-ca">CA</button>
                <button onclick="setLang('en')" id="btn-en">EN</button>
                <button onclick="setLang('fr')" id="btn-fr">FR</button>
                <button onclick="setLang('de')" id="btn-de">DE</button>
                <button onclick="setLang('pt')" id="btn-pt">PT</button>
                <button onclick="setLang('it')" id="btn-it">IT</button>
                <button onclick="setLang('nl')" id="btn-nl">NL</button>
                <button onclick="setLang('ja')" id="btn-ja">JP</button>
            </div>
        </nav>

        <h1 id="txt-title">PROYECTO FOURIER</h1>
        <p style="color:var(--muted); margin-bottom: 20px;" id="txt-desc">Transformada de Fourier y visualizaci√≥n de Epiciclos.</p>

        <div class="controls">
            <div class="status-text" id="status-display">MODO: VISUALIZACI√ìN</div>
            
            <div class="buttons-row">
                <button class="action-btn" onclick="startDrawing()" id="btn-draw">‚úèÔ∏è DIBUJAR</button>
                <button class="secondary-btn" onclick="loadExample()" id="btn-example">‚òÖ EJEMPLO (œÄ)</button>
                <button class="secondary-btn" onclick="saveImage()" id="btn-save">üíæ IMG HQ</button>
            </div>
        </div>

        <div id="canvas-container">
            <canvas id="fourier-canvas" width="800" height="600"></canvas>
            <p style="color:var(--muted); font-size: 0.8rem; margin-top:5px;" id="txt-note">Haz clic en 'DIBUJAR' y traza una l√≠nea continua en el recuadro.</p>
        </div>

        <div class="info-section">
            <h2 id="info-h-calc">Dibujando con C√≠rculos</h2>
            <p id="info-p-calc">
                Joseph Fourier descubri√≥ en 1807 que cualquier funci√≥n peri√≥dica (o forma cerrada) puede reescribirse como una suma infinita de funciones sinusoidales simples. En t√©rminos visuales: cualquier dibujo puede crearse sumando c√≠rculos que giran sobre otros c√≠rculos (epiciclos).
            </p>

            <h2 id="info-h-dft">La Transformada (DFT)</h2>
            <p id="info-p-dft">
                Cuando dibujas en este laboratorio, tomamos tus coordenadas $(x, y)$ y las convertimos en n√∫meros complejos. Luego aplicamos la Transformada Discreta de Fourier para encontrar la "receta" de tu dibujo: el tama√±o (amplitud), velocidad (frecuencia) y √°ngulo inicial (fase) de cada c√≠rculo necesario para recrearlo.
            </p>
            
            <div class="math-box">
                X[k] = Œ£ x[n] ¬∑ e^(-i¬∑2œÄ¬∑k¬∑n / N)
            </div>

            <div class="dl-section">
                <h3 style="color:var(--secondary); margin-bottom:15px;" id="h-dl-coeff">Descarga de Coeficientes</h3>
                <p id="p-dl-coeff" style="font-size:0.9rem;">
                    Descarga los datos matem√°ticos puros de tu dibujo: frecuencia, amplitud y fase de cada epiciclo calculado.
                </p>
                <button onclick="downloadCoefficients()" class="btn-txt-dl" id="btn-dl-coeff">
                    ‚¨á Descargar Coeficientes (.csv)
                </button>
            </div>
        </div>

        <div class="ad-container"><span class="ad-placeholder-text">Ad Space</span></div>
    </div>

    <footer>
        <div class="legal-links">
            <a href="../../legal.html" id="link-legal">Aviso Legal</a>
            <a href="../../privacy.html" id="link-privacy">Pol√≠tica de Privacidad</a>
            <a href="../../cookies.html" id="link-cookies">Pol√≠tica de Cookies</a>
            <a href="mailto:pbazan@gmail.com" id="link-contact">Contacto</a>
        </div>
        <span id="footer-rights">¬© 2025 Graphics Labs</span>
        <a href="https://paypal.me/pbazan" target="_blank" class="coffee-btn">
            ‚òï <span id="btn-coffee">Inv√≠tame a un caf√©</span>
        </a>
    </footer>

    <script>
        /* --- 1. MATEM√ÅTICAS DFT --- */
        class Complex {
            constructor(a, b) { this.re = a; this.im = b; }
            add(c) { this.re += c.re; this.im += c.im; }
            mult(c) {
                const re = this.re * c.re - this.im * c.im;
                const im = this.re * c.im + this.im * c.re;
                return new Complex(re, im);
            }
        }

        function dft(x) {
            const X = [];
            const N = x.length;
            for (let k = 0; k < N; k++) {
                let sum = new Complex(0, 0);
                for (let n = 0; n < N; n++) {
                    const phi = (2 * Math.PI * k * n) / N;
                    const c = new Complex(Math.cos(phi), -Math.sin(phi));
                    sum.add(x[n].mult(c));
                }
                sum.re = sum.re / N;
                sum.im = sum.im / N;

                let freq = k;
                let amp = Math.sqrt(sum.re * sum.re + sum.im * sum.im);
                let phase = Math.atan2(sum.im, sum.re);
                X[k] = { re: sum.re, im: sum.im, freq, amp, phase };
            }
            return X;
        }

        /* --- 2. CONFIGURACI√ìN --- */
        const canvas = document.getElementById('fourier-canvas');
        const ctx = canvas.getContext('2d');
        const statusDisplay = document.getElementById('status-display');
        
        let drawing = []; // Puntos del usuario
        let fourierX = []; // Coeficientes complejos
        let time = 0;
        let path = []; // Camino dibujado por los c√≠rculos
        let state = -1; // -1: Idle, 0: User Drawing, 1: Fourier Computing, 2: Animating

        /* --- 3. INPUT USUARIO --- */
        function startDrawing() {
            state = 0;
            drawing = [];
            fourierX = [];
            path = [];
            time = 0;
            statusDisplay.innerText = translations[currentLang].state_drawing || "DIBUJANDO...";
            ctx.clearRect(0,0,canvas.width, canvas.height);
        }

        // --- EVENTOS RAT√ìN ---
        canvas.addEventListener('mousedown', e => {
            if(state !== 0) return;
            isMouseDown = true;
            drawing = []; // Reset on new click
        });
        
        let isMouseDown = false;
        canvas.addEventListener('mouseup', () => {
            if(state === 0 && drawing.length > 5) {
                isMouseDown = false;
                state = 1; // Compute
                statusDisplay.innerText = translations[currentLang].state_computing || "CALCULANDO...";
                setTimeout(computeFourier, 50); // Give UI time to update
            }
        });

        canvas.addEventListener('mousemove', e => {
            if(state === 0 && isMouseDown) {
                const rect = canvas.getBoundingClientRect();
                // Centramos coordenadas relativas al canvas
                const x = e.clientX - rect.left - canvas.width / 2;
                const y = e.clientY - rect.top - canvas.height / 2;
                drawing.push(new Complex(x, y));
                
                // Dibujar trazo usuario
                ctx.lineWidth = 2;
                ctx.strokeStyle = "#fff";
                ctx.beginPath();
                ctx.moveTo(x + canvas.width/2, y + canvas.height/2);
                ctx.lineTo(x + canvas.width/2, y + canvas.height/2);
                ctx.stroke();
                
                // Unir puntos
                if(drawing.length > 1) {
                    const prev = drawing[drawing.length-2];
                    ctx.beginPath();
                    ctx.moveTo(prev.re + canvas.width/2, prev.im + canvas.height/2);
                    ctx.lineTo(x + canvas.width/2, y + canvas.height/2);
                    ctx.stroke();
                }
            }
        });

        // --- SOPORTE T√ÅCTIL (M√ìVIL) --- 
        canvas.addEventListener('touchstart', e => {
            e.preventDefault(); // Evita scroll
            if(state !== 0) return;
            isMouseDown = true;
            drawing = []; 
        }, { passive: false });

        canvas.addEventListener('touchend', e => {
            e.preventDefault();
            if(state === 0 && drawing.length > 5) {
                isMouseDown = false;
                state = 1; 
                statusDisplay.innerText = translations[currentLang].state_computing || "CALCULANDO...";
                setTimeout(computeFourier, 50); 
            }
        }, { passive: false });

        canvas.addEventListener('touchmove', e => {
            e.preventDefault(); // Evita scroll mientras dibujas
            if(state === 0 && isMouseDown) {
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0]; // Usamos el primer dedo
                
                // Centramos coordenadas (igual que mousemove)
                const x = touch.clientX - rect.left - canvas.width / 2;
                const y = touch.clientY - rect.top - canvas.height / 2;
                
                drawing.push(new Complex(x, y));
                
                // Visualizaci√≥n del trazo
                ctx.lineWidth = 2;
                ctx.strokeStyle = "#fff";
                ctx.beginPath();
                ctx.moveTo(x + canvas.width/2, y + canvas.height/2);
                ctx.lineTo(x + canvas.width/2, y + canvas.height/2);
                ctx.stroke();
                
                if(drawing.length > 1) {
                    const prev = drawing[drawing.length-2];
                    ctx.beginPath();
                    ctx.moveTo(prev.re + canvas.width/2, prev.im + canvas.height/2);
                    ctx.lineTo(x + canvas.width/2, y + canvas.height/2);
                    ctx.stroke();
                }
            }
        }, { passive: false });


        /* --- 4. L√ìGICA --- */
        function computeFourier() {
            // Optimizaci√≥n: Si hay demasiados puntos, saltar algunos
            const skip = Math.ceil(drawing.length / 300); 
            let reducedDrawing = [];
            for(let i=0; i<drawing.length; i+=skip) {
                reducedDrawing.push(drawing[i]);
            }
            
            fourierX = dft(reducedDrawing);
            
            // Ordenar por amplitud para mejor visualizaci√≥n (c√≠rculos grandes primero)
            fourierX.sort((a, b) => b.amp - a.amp);
            
            state = 2; // Animating
            statusDisplay.innerText = translations[currentLang].state_animating || "ANIMANDO";
            time = 0;
            path = [];
        }

        function epicycles(x, y, rotation, fourier, targetCtx, scale = 1) {
            for (let i = 0; i < fourier.length; i++) {
                let prevx = x;
                let prevy = y;
                let freq = fourier[i].freq;
                let radius = fourier[i].amp * scale;
                let phase = fourier[i].phase;
                
                // Posici√≥n actual del c√≠rculo
                x += radius * Math.cos(freq * time + phase + rotation);
                y += radius * Math.sin(freq * time + phase + rotation);

                // Dibujar c√≠rculo
                targetCtx.strokeStyle = "rgba(255, 255, 255, 0.1)";
                targetCtx.lineWidth = 1 * scale;
                targetCtx.beginPath();
                targetCtx.arc(prevx, prevy, radius, 0, 2 * Math.PI);
                targetCtx.stroke();

                // Dibujar radio (linea)
                targetCtx.strokeStyle = "rgba(255, 255, 255, 0.4)";
                targetCtx.beginPath();
                targetCtx.moveTo(prevx, prevy);
                targetCtx.lineTo(x, y);
                targetCtx.stroke();
            }
            return { x, y };
        }

        function draw() {
            if (state === 2) {
                ctx.fillStyle = "#000";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                let v = epicycles(canvas.width / 2, canvas.height / 2, 0, fourierX, ctx);
                
                // Agregar punto al camino
                path.unshift(v);
                if(path.length > fourierX.length * 2) path.pop(); // Limitar rastro

                // Dibujar el dibujo resultante
                ctx.beginPath();
                ctx.moveTo(path[0].x, path[0].y);
                for (let i = 1; i < path.length; i++) {
                    ctx.lineTo(path[i].x, path[i].y);
                }
                ctx.strokeStyle = "#00ff41"; // Verde Matrix
                ctx.lineWidth = 2;
                ctx.stroke();

                const dt = (2 * Math.PI) / fourierX.length;
                time += dt;

                if (time > 2 * Math.PI) {
                    time = 0;
                    path = [];
                }
            }
            requestAnimationFrame(draw);
        }

        /* --- 5. EJEMPLO PI --- */
        function loadExample() {
            state = 1;
            statusDisplay.innerText = "CARGANDO EJEMPLO...";
            drawing = [];
            
            // Generar forma de PI aproximada
            // (Simplificado para demo, coord relativas)
            const piPoints = [
                [-50,-50], [50,-50], [50,-40], [10,-40], [10,50], [30,50], [30,60], 
                [0,60], [0,-40], [-20,-40], [-20,50], [-40,50], [-40,-40], [-50,-40]
            ];
            
            // Interpolaci√≥n para suavizar
            for(let i=0; i<piPoints.length; i++) {
                let p1 = piPoints[i];
                let p2 = piPoints[(i+1)%piPoints.length];
                for(let t=0; t<1; t+=0.1) {
                    let x = p1[0] + (p2[0] - p1[0])*t;
                    let y = p1[1] + (p2[1] - p1[1])*t;
                    drawing.push(new Complex(x * 2, y * 2)); // Escalar un poco
                }
            }
            
            setTimeout(computeFourier, 100);
        }

        /* --- 6. DESCARGAS --- */
        function saveImage() {
            const link = document.createElement('a');
            link.download = 'fourier_art.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function downloadCoefficients() {
            if(fourierX.length === 0) return;
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Frequency,Amplitude,Phase,Real,Imaginary\n";
            
            fourierX.forEach(f => {
                csvContent += `${f.freq},${f.amp.toFixed(4)},${f.phase.toFixed(4)},${f.re.toFixed(4)},${f.im.toFixed(4)}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "fourier_coefficients.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        /* --- 7. FONDO ANIMADO --- */
        const bgCanvas = document.getElementById('bg-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        let particlesArray = [];
        const mouse = { x: null, y: null, radius: 150 };

        window.addEventListener('mousemove', (e) => { mouse.x = e.x; mouse.y = e.y; });
        function resizeBg() { bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight; }
        window.addEventListener('resize', () => { resizeBg(); initParticles(); });
        resizeBg();

        class Particle {
            constructor() {
                this.x = Math.random() * bgCanvas.width;
                this.y = Math.random() * bgCanvas.height;
                this.size = Math.random() * 12 + 8;
                this.speedX = (Math.random() * 1) - 0.5;
                this.speedY = (Math.random() * 1) - 0.5;
                const symbols = ['‚à´', 'e', 'iœÄ', 'sin', 'cos', 'Œ£', '∆í'];
                this.text = symbols[Math.floor(Math.random() * symbols.length)];
            }
            draw() {
                bgCtx.font = this.size + 'px monospace';
                bgCtx.fillStyle = 'rgba(0, 255, 65, 0.15)'; 
                bgCtx.fillText(this.text, this.x, this.y);
            }
            update() {
                this.x += this.speedX; this.y += this.speedY;
                if (mouse.x != null) {
                    let dx = mouse.x - this.x;
                    let dy = mouse.y - this.y;
                    let distance = Math.sqrt(dx*dx + dy*dy);
                    if (distance < mouse.radius) {
                        const forceDirectionX = dx / distance;
                        const forceDirectionY = dy / distance;
                        const force = (mouse.radius - distance) / mouse.radius;
                        this.x -= forceDirectionX * force * 5;
                        this.y -= forceDirectionY * force * 5;
                    }
                }
                if (this.x > bgCanvas.width) this.x = 0; if (this.x < 0) this.x = bgCanvas.width;
                if (this.y > bgCanvas.height) this.y = 0; if (this.y < 0) this.y = bgCanvas.height;
                this.draw();
            }
        }

        function initParticles() {
            particlesArray = [];
            let n = (bgCanvas.height * bgCanvas.width) / 9000;
            for (let i = 0; i < n; i++) particlesArray.push(new Particle());
        }
        function animateParticles() {
            bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
            for (let i = 0; i < particlesArray.length; i++) particlesArray[i].update();
            requestAnimationFrame(animateParticles);
        }
        initParticles(); animateParticles();

        /* --- 8. MULTI-IDIOMA --- */
        const translations = {
            'es': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "PROYECTO FOURIER", desc: "Transformada de Fourier y visualizaci√≥n de Epiciclos.",
                btn_draw: "‚úèÔ∏è DIBUJAR", btn_example: "‚òÖ EJEMPLO (œÄ)", btn_save: "üíæ IMG HQ",
                txt_note: "Haz clic en 'DIBUJAR' y traza una l√≠nea continua en el recuadro.",
                state_drawing: "MODO: DIBUJAR (Haz clic y arrastra)",
                state_computing: "CALCULANDO FOURIER...",
                state_animating: "MODO: ANIMACI√ìN",
                h_calc: "Dibujando con C√≠rculos",
                p_calc: "Joseph Fourier descubri√≥ en 1807 que cualquier funci√≥n peri√≥dica puede reescribirse como una suma infinita de funciones sinusoidales simples. Visualmente: cualquier dibujo puede crearse sumando c√≠rculos que giran sobre otros c√≠rculos (epiciclos).",
                h_dft: "La Transformada (DFT)",
                p_dft: "Cuando dibujas, tomamos tus coordenadas y las convertimos en n√∫meros complejos. Luego aplicamos la Transformada Discreta de Fourier para encontrar la 'receta': tama√±o, velocidad y √°ngulo de cada c√≠rculo.",
                h_dl_coeff: "Descarga de Coeficientes", p_dl_coeff: "Descarga los datos matem√°ticos puros: frecuencia, amplitud y fase de cada epiciclo.",
                btn_dl_coeff: "‚¨á Descargar Coeficientes (.csv)",
                legal: "Aviso Legal", privacy: "Privacidad", cookies: "Cookies", contact: "Contacto", coffee: "Inv√≠tame a un caf√©"
            },
            'en': {
                nav_main: "‚Üê MAIN HUB", nav_math: "‚Üê MATH HUB",
                title: "PROJECT FOURIER", desc: "Fourier Transform and Epicycles visualization.",
                btn_draw: "‚úèÔ∏è DRAW", btn_example: "‚òÖ EXAMPLE (œÄ)", btn_save: "üíæ IMG HQ",
                txt_note: "Click 'DRAW' and trace a continuous line on the canvas.",
                state_drawing: "MODE: DRAWING (Click and drag)",
                state_computing: "COMPUTING FOURIER...",
                state_animating: "MODE: ANIMATION",
                h_calc: "Drawing with Circles",
                p_calc: "Joseph Fourier discovered in 1807 that any periodic function can be rewritten as an infinite sum of simple sine waves. Visually: any drawing can be created by adding circles rotating upon other circles (epicycles).",
                h_dft: "The Transform (DFT)",
                p_dft: "When you draw, we take your coordinates as complex numbers. Then we apply the Discrete Fourier Transform to find the 'recipe': size, speed, and angle of each circle.",
                h_dl_coeff: "Download Coefficients", p_dl_coeff: "Download pure math data: frequency, amplitude, and phase of each epicycle.",
                btn_dl_coeff: "‚¨á Download Coefficients (.csv)",
                legal: "Legal Notice", privacy: "Privacy Policy", cookies: "Cookies", contact: "Contact", coffee: "Buy me a coffee"
            },
            'ca': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "PROJECTE FOURIER", desc: "Transformada de Fourier i visualitzaci√≥ d'Epicicles.",
                btn_draw: "‚úèÔ∏è DIBUIXAR", btn_example: "‚òÖ EXEMPLE (œÄ)", btn_save: "üíæ IMG HQ",
                txt_note: "Fes clic a 'DIBUIXAR' i tra√ßa una l√≠nia cont√≠nua al requadre.",
                state_drawing: "MODE: DIBUIXAR (Fes clic i arrossega)",
                state_computing: "CALCULANT FOURIER...",
                state_animating: "MODE: ANIMACI√ì",
                h_calc: "Dibuixant amb Cercles",
                p_calc: "Joseph Fourier va descobrir el 1807 que qualsevol funci√≥ peri√≤dica pot reescriure's com una suma infinita de funcions sinusoidals simples. Visualment: qualsevol dibuix pot crear-se sumant cercles que giren sobre altres cercles.",
                h_dft: "La Transformada (DFT)",
                p_dft: "Quan dibuixes, prenem les teves coordenades com a nombres complexos. Despr√©s apliquem la Transformada Discreta de Fourier per trobar la 'recepta': mida, velocitat i angle de cada cercle.",
                h_dl_coeff: "Desc√†rrega de Coeficients", p_dl_coeff: "Descarrega les dades matem√†tiques pures: freq√º√®ncia, amplitud i fase.",
                btn_dl_coeff: "‚¨á Descarregar Coeficients (.csv)",
                legal: "Av√≠s Legal", privacy: "Privacitat", cookies: "Cookies", contact: "Contacte", coffee: "Convida'm a un caf√®"
            },
            'fr': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "PROJET FOURIER", desc: "Transformation de Fourier et visualisation d'√âpicycles.",
                btn_draw: "‚úèÔ∏è DESSINER", btn_example: "‚òÖ EXEMPLE (œÄ)", btn_save: "üíæ IMG HQ",
                txt_note: "Cliquez sur 'DESSINER' et tracez une ligne continue.",
                state_drawing: "MODE : DESSIN (Cliquez et glissez)",
                state_computing: "CALCUL FOURIER...",
                state_animating: "MODE : ANIMATION",
                h_calc: "Dessiner avec des Cercles",
                p_calc: "Joseph Fourier a d√©couvert en 1807 que toute fonction p√©riodique peut √™tre r√©√©crite comme une somme infinie d'ondes sinuso√Ødales simples. Visuellement : tout dessin peut √™tre cr√©√© en additionnant des cercles.",
                h_dft: "La Transform√©e (DFT)",
                p_dft: "Lorsque vous dessinez, nous prenons vos coordonn√©es comme nombres complexes. Ensuite, nous appliquons la Transform√©e de Fourier Discr√®te pour trouver la 'recette' : taille, vitesse et angle de chaque cercle.",
                h_dl_coeff: "T√©l√©charger Coefficients", p_dl_coeff: "T√©l√©chargez les donn√©es math√©matiques pures : fr√©quence, amplitude et phase.",
                btn_dl_coeff: "‚¨á T√©l√©charger Coefficients (.csv)",
                legal: "Mentions L√©gales", privacy: "Confidentialit√©", cookies: "Cookies", contact: "Contact", coffee: "Offrez-moi un caf√©"
            },
            'de': {
                nav_main: "‚Üê HAUPT-HUB", nav_math: "‚Üê MATH HUB",
                title: "PROJEKT FOURIER", desc: "Fourier-Transformation und Epizykel-Visualisierung.",
                btn_draw: "‚úèÔ∏è ZEICHNEN", btn_example: "‚òÖ BEISPIEL (œÄ)", btn_save: "üíæ IMG HQ",
                txt_note: "Klicken Sie auf 'ZEICHNEN' und ziehen Sie eine durchgehende Linie.",
                state_drawing: "MODUS: ZEICHNEN (Klicken und ziehen)",
                state_computing: "BERECHNE FOURIER...",
                state_animating: "MODUS: ANIMATION",
                h_calc: "Zeichnen mit Kreisen",
                p_calc: "Joseph Fourier entdeckte 1807, dass jede periodische Funktion als unendliche Summe einfacher Sinuswellen umgeschrieben werden kann. Visuell: Jede Zeichnung kann durch Addition rotierender Kreise erstellt werden.",
                h_dft: "Die Transformation (DFT)",
                p_dft: "Wenn Sie zeichnen, nehmen wir Ihre Koordinaten als komplexe Zahlen. Dann wenden wir die Diskrete Fourier-Transformation an, um das 'Rezept' zu finden: Gr√∂√üe, Geschwindigkeit und Winkel jedes Kreises.",
                h_dl_coeff: "Koeffizienten herunterladen", p_dl_coeff: "Laden Sie reine mathematische Daten herunter: Frequenz, Amplitude und Phase.",
                btn_dl_coeff: "‚¨á Koeffizienten herunterladen (.csv)",
                legal: "Impressum", privacy: "Datenschutz", cookies: "Cookies", contact: "Kontakt", coffee: "Kauf mir einen Kaffee"
            },
            'pt': {
                nav_main: "‚Üê HUB PRINCIPAL", nav_math: "‚Üê HUB MATH",
                title: "PROJETO FOURIER", desc: "Transformada de Fourier e visualiza√ß√£o de Epiciclos.",
                btn_draw: "‚úèÔ∏è DESENHAR", btn_example: "‚òÖ EXEMPLO (œÄ)", btn_save: "üíæ IMG HQ",
                txt_note: "Clique em 'DESENHAR' e trace uma linha cont√≠nua.",
                state_drawing: "MODO: DESENHO (Clique e arraste)",
                state_computing: "CALCULANDO FOURIER...",
                state_animating: "MODO: ANIMA√á√ÉO",
                h_calc: "Desenhando com C√≠rculos",
                p_calc: "Joseph Fourier descobriu em 1807 que qualquer fun√ß√£o peri√≥dica pode ser reescrita como uma soma infinita de ondas senoidais simples. Visualmente: qualquer desenho pode ser criado somando c√≠rculos.",
                h_dft: "A Transformada (DFT)",
                p_dft: "Quando voc√™ desenha, tomamos suas coordenadas como n√∫meros complexos. Em seguida, aplicamos a Transformada Discreta de Fourier para encontrar a 'receita': tamanho, velocidade e √¢ngulo de cada c√≠rculo.",
                h_dl_coeff: "Baixar Coeficientes", p_dl_coeff: "Baixe dados matem√°ticos puros: frequ√™ncia, amplitude e fase.",
                btn_dl_coeff: "‚¨á Baixar Coeficientes (.csv)",
                legal: "Aviso Legal", privacy: "Privacidade", cookies: "Cookies", contact: "Contato", coffee: "Pagar um caf√©"
            },
            'it': {
                nav_main: "‚Üê HUB PRINCIPALE", nav_math: "‚Üê HUB MATH",
                title: "PROGETTO FOURIER", desc: "Trasformata di Fourier e visualizzazione di Epicicli.",
                btn_draw: "‚úèÔ∏è DISEGNARE", btn_example: "‚òÖ ESEMPIO (œÄ)", btn_save: "üíæ IMG HQ",
                txt_note: "Clicca su 'DISEGNARE' e traccia una linea continua.",
                state_drawing: "MODO: DISEGNO (Clicca e trascina)",
                state_computing: "CALCOLO FOURIER...",
                state_animating: "MODO: ANIMAZIONE",
                h_calc: "Disegnare con Cerchi",
                p_calc: "Joseph Fourier scopr√¨ nel 1807 che qualsiasi funzione periodica pu√≤ essere riscritta come somma infinita di onde sinusoidali semplici. Visivamente: qualsiasi disegno pu√≤ essere creato sommando cerchi.",
                h_dft: "La Trasformata (DFT)",
                p_dft: "Quando disegni, prendiamo le tue coordinate come numeri complessi. Quindi applichiamo la Trasformata Discreta di Fourier per trovare la 'ricetta': dimensione, velocit√† e angolo di ogni cerchio.",
                h_dl_coeff: "Scarica Coefficienti", p_dl_coeff: "Scarica dati matematici puri: frequenza, ampiezza e fase.",
                btn_dl_coeff: "‚¨á Scarica Coefficienti (.csv)",
                legal: "Note Legali", privacy: "Privacy", cookies: "Cookies", contact: "Contatto", coffee: "Offrimi un caff√®"
            },
            'nl': {
                nav_main: "‚Üê HOOFDHUB", nav_math: "‚Üê MATH HUB",
                title: "PROJECT FOURIER", desc: "Fourier Transformatie en Epicycli visualisatie.",
                btn_draw: "‚úèÔ∏è TEKENEN", btn_example: "‚òÖ VOORBEELD (œÄ)", btn_save: "üíæ IMG HQ",
                txt_note: "Klik op 'TEKENEN' en trek een ononderbroken lijn.",
                state_drawing: "MODUS: TEKENEN (Klik en sleep)",
                state_computing: "FOURIER BEREKENEN...",
                state_animating: "MODUS: ANIMATIE",
                h_calc: "Tekenen met Cirkels",
                p_calc: "Joseph Fourier ontdekte in 1807 dat elke periodieke functie herschreven kan worden als een oneindige som van eenvoudige sinusgolven. Visueel: elke tekening kan gemaakt worden door cirkels op te tellen.",
                h_dft: "De Transformatie (DFT)",
                p_dft: "Wanneer je tekent, nemen we je co√∂rdinaten als complexe getallen. Vervolgens passen we de Discrete Fourier Transformatie toe om het 'recept' te vinden: grootte, snelheid en hoek van elke cirkel.",
                h_dl_coeff: "Co√´ffici√´nten Downloaden", p_dl_coeff: "Download pure wiskundige gegevens: frequentie, amplitude en fase.",
                btn_dl_coeff: "‚¨á Download Co√´ffici√´nten (.csv)",
                legal: "Juridisch", privacy: "Privacy", cookies: "Cookies", contact: "Contact", coffee: "Koop koffie"
            },
            'ja': {
                nav_main: "‚Üê „É°„Ç§„É≥„Éè„Éñ", nav_math: "‚Üê Êï∞Â≠¶„Éè„Éñ",
                title: "„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éª„Éï„Éº„É™„Ç®", desc: "„Éï„Éº„É™„Ç®Â§âÊèõ„Å®Âë®Ëª¢ÂÜÜ„ÅÆË¶ñË¶öÂåñ„ÄÇ",
                btn_draw: "‚úèÔ∏è Êèè„Åè", btn_example: "‚òÖ ‰æã (œÄ)", btn_save: "üíæ ÁîªÂÉè‰øùÂ≠ò HQ",
                txt_note: "„ÄåÊèè„Åè„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÄÅÈÄ£Á∂ö„Åó„ÅüÁ∑ö„ÇíÊèè„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                state_drawing: "„É¢„Éº„ÉâÔºöÊèèÁîªÔºà„ÇØ„É™„ÉÉ„ÇØÔºÜ„Éâ„É©„ÉÉ„Ç∞Ôºâ",
                state_computing: "„Éï„Éº„É™„Ç®Ë®àÁÆó‰∏≠...",
                state_animating: "„É¢„Éº„ÉâÔºö„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥",
                h_calc: "ÂÜÜ„ÅßÊèè„Åè",
                p_calc: "„Ç∏„Éß„Çº„Éï„Éª„Éï„Éº„É™„Ç®„ÅØ1807Âπ¥„Å´„ÄÅ„ÅÇ„Çâ„ÇÜ„ÇãÂë®ÊúüÈñ¢Êï∞„ÅåÂçòÁ¥î„Å™Ê≠£Âº¶Ê≥¢„ÅÆÁÑ°ÈôêÂíå„Å®„Åó„Å¶Êõ∏„ÅçÊèõ„Åà„Çâ„Çå„Çã„Åì„Å®„ÇíÁô∫Ë¶ã„Åó„Åæ„Åó„Åü„ÄÇË¶ñË¶öÁöÑ„Å´„ÅØ„ÄÅ„Å©„Çì„Å™Áµµ„ÇÇÂÜÜ„ÇíË∂≥„ÅóÂêà„Çè„Åõ„Çã„Åì„Å®„Åß‰ΩúÊàê„Åß„Åç„Åæ„Åô„ÄÇ",
                h_dft: "Â§âÊèõ (DFT)",
                p_dft: "„ÅÇ„Å™„Åü„ÅåÊèè„Åè„Å®„Åç„ÄÅÂ∫ßÊ®ô„ÇíË§áÁ¥†Êï∞„Å®„Åó„Å¶ÂèñÂæó„Åó„Åæ„Åô„ÄÇÊ¨°„Å´Èõ¢Êï£„Éï„Éº„É™„Ç®Â§âÊèõ„ÇíÈÅ©Áî®„Åó„Å¶„ÄÅÂêÑÂÜÜ„ÅÆ„Çµ„Ç§„Ç∫„ÄÅÈÄüÂ∫¶„ÄÅËßíÂ∫¶„Å®„ÅÑ„ÅÜ„Äå„É¨„Ç∑„Éî„Äç„ÇíË¶ã„Å§„Åë„Åæ„Åô„ÄÇ",
                h_dl_coeff: "‰øÇÊï∞„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ", p_dl_coeff: "Âë®Ê≥¢Êï∞„ÄÅÊåØÂπÖ„ÄÅ‰ΩçÁõ∏„Å™„Å©„ÅÆÁ¥îÁ≤ã„Å™Êï∞Â≠¶„Éá„Éº„Çø„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ",
                btn_dl_coeff: "‚¨á ‰øÇÊï∞„ÇíDL (.csv)",
                legal: "Ê≥ïÁöÑÈÄöÁü•", privacy: "„Éó„É©„Ç§„Éê„Ç∑„Éº", cookies: "„ÇØ„ÉÉ„Ç≠„Éº", contact: "ÈÄ£Áµ°ÂÖà", coffee: "„Ç≥„Éº„Éí„Éº„ÇíÂ•¢„Çã"
            }
        };

        // INIT
        const savedLang = localStorage.getItem('gl_lang') || 'es';
        let currentLang = savedLang;
        
        function setLang(lang) {
            localStorage.setItem('gl_lang', lang);
            currentLang = lang;
            const t = translations[lang] || translations['es'];
            
            document.getElementById('nav-main').innerText = t.nav_main;
            document.getElementById('nav-math').innerText = t.nav_math;
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-desc').innerText = t.desc;
            
            document.getElementById('btn-draw').innerText = t.btn_draw;
            document.getElementById('btn-example').innerText = t.btn_example;
            document.getElementById('btn-save').innerText = t.btn_save;
            document.getElementById('txt-note').innerText = t.txt_note;

            document.getElementById('info-h-calc').innerText = t.h_calc;
            document.getElementById('info-p-calc').innerText = t.p_calc;
            document.getElementById('info-h-dft').innerText = t.h_dft;
            document.getElementById('info-p-dft').innerText = t.p_dft;
            
            document.getElementById('h-dl-coeff').innerText = t.h_dl_coeff;
            document.getElementById('p-dl-coeff').innerText = t.p_dl_coeff;
            document.getElementById('btn-dl-coeff').innerText = t.btn_dl_coeff;

            document.getElementById('link-legal').innerText = t.legal;
            document.getElementById('link-privacy').innerText = t.privacy;
            document.getElementById('link-cookies').innerText = t.cookies;
            document.getElementById('link-contact').innerText = t.contact;
            document.getElementById('btn-coffee').innerText = t.coffee;

            document.querySelectorAll('.lang-switch button').forEach(b => {
                b.classList.remove('active');
                if(b.id === 'btn-' + lang) b.classList.add('active');
            });
        }

        setLang(savedLang);
        loadExample(); // Start with Pi example
        requestAnimationFrame(draw);

    </script>
</body>
</html>
